function humanDigits(e,t){return 2==t.length?1==e?t[0]:t[1]:(20<(e=0==e||100==e?10:e%100)&&(e=0==(e%=10)?e=10:e),e<=1?t[0]:e<5?t[1]:e<21?t[2]:"???")}window.reqAnimationFrame||(window.reqAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}),"undefined"==typeof Tildaupload_UPLOADKEY&&(Tildaupload_UPLOADKEY=""),function(){var r,t,e,d,n,i,s,W,P,a=[].slice,o={}.hasOwnProperty;function l(){}function S(e,t){var i;if(this.element=e,this.version=S.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid tildaupload element.");if(this.elementid=this.element.getAttribute("id"),this.elementid||(this.elementid="tildaupload"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),this.element.setAttribute("id",this.elementid)),this.element.tildaupload&&console.log("Error: Tildaupload already attached to "+this.elementid),this.options=W({},this.defaultOptions,void 0,null!=t?t:{}),this.originalelement||(this.originalelement=this.element),"INPUT"==this.element.nodeName&&(null===(i=this.element.getAttribute("data-tu-text-button"))&&(i=this.options.dicts[this.options.locale].buttonUpload,this.options.uploadMultiple&&(i=this.options.dicts[this.options.locale].buttonUploads)),this.element=S.createElement('<div id="'+this.elementid+'-previews"  class="tu-popup-progressbar-container tu-popup-progressbar-start"> <div class="tu-popup-progressbar-error-container"> <div class="tu-popup-progressbar-error-wrapper"> <div class="tu-popup-progressbar-error-title">Upload error &gt; </div><div class="tu-popup-progressbar-error-text" data-tu-errormessage>Image files allowed only</div> </div> </div> <div class="tu-popup-progressbar-steps"> <div class="tu-popup-progressbar-step3"> <div class="tu-popup-toggler '+this.elementid+'-button" id="'+this.elementid+'-button">'+i+'</div> <div class="tu-popup-progressbar-final '+this.elementid+'-button"> <div class="tu-popup-progressbar-final-text"> <span data-tu-name></span> <span data-tu-size>0KB</span> </div> </div> </div> <div class="tu-popup-progressbar-step2"> <div class="tu-popup-progressbar-checkmark-wrapper"> <div class="tu-popup-progressbar-checkmark"> <div class="tu-popup-progressbar-checkmark_stem"></div> <div class="tu-popup-progressbar-checkmark_kick"></div> </div> </div> </div> <div class="tu-popup-progressbar-step1"> <div class="tu-popup-progressbar-bg" data-tu-uploadprogress></div> <div class="tu-popup-progressbar-text">'+this.options.dicts[this.options.locale].uploading+'</div> <div class="tu-popup-progressbar-close-wrapper" data-tu-remove> <div class="tu-popup-progressbar-close"></div> <div class="tu-popup-progressbar-close-line tu-popup-progressbar-close-line-first"></div> <div class="tu-popup-progressbar-close-line tu-popup-progressbar-close-line-second"></div> </div> </div> </div> </div>'),this.originalelement.parentNode.insertBefore(this.element,this.originalelement),this.originalelement.style.display="none",this.element.style.display=""),S.instances.push(this),this.element.tildaupload=this,i=null!=(i=S.optionsForElement(this.element))?i:{},this.options=W({},this.defaultOptions,i,null!=t?t:{}),this.options.forceFallback||!S.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");if(this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(t=this.getExistingFallback())&&t.parentNode&&t.parentNode.removeChild(t),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=S.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.uploadMultiple&&(this.options.previewTemplate='<div class="tu-uploader-multiple-img-item tu-js-preview-item"> <div class="tu-uploader-multiple-img-wrapper"> <div class="tu-uploader-multiple-img-separator"></div> <div class="tu-uploader-multiple-img-progressbar" data-tu-uploadprogress="" style="width:0%;"></div> <div class="tu-uploader-multiple-img" data-tu-thumbnail></div> <div class="tu-uploader-multiple-remover" data-tu-remove=""> <div class="tu-uploader-multiple-remover-line tu-uploader-multiple-remover-line-first"></div> <div class="tu-uploader-multiple-remover-line tu-uploader-multiple-remover-line-second"></div> </div> </div> </div>'),this.options.clickable)if(!0===this.options.clickable)if(this.element==this.emptydropzone){var s,o=S.getElements("#"+this.emptydropzone.getAttribute("id")+" .tu-clickable","clickable");for(this.clickableElements=[this.originalelement],s=0;s<o.length;s++)this.clickableElements.push(o[s])}else this.clickableElements=[this.element];else this.clickableElements=S.getElements(this.options.clickable,"clickable");var l=this;setTimeout(function(){l.init()},150)}i=function(){},l.prototype.addEventListener=l.prototype.on,l.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},l.prototype.emit=function(){var e,t,i,s=arguments[0],o=2<=arguments.length?a.call(arguments,1):[];if(this._callbacks=this._callbacks||{},e=this._callbacks[s])for(t=0,i=e.length;t<i;t++)e[t].apply(this,o);return this},l.prototype.removeListener=l.prototype.off,l.prototype.removeAllListeners=l.prototype.off,l.prototype.removeEventListener=l.prototype.off,l.prototype.off=function(e,t){var i,s,o,l;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(!(i=this._callbacks[e]))return this;if(1===arguments.length)return delete this._callbacks[e],this;for(s=o=0,l=i.length;o<l;s=++o)if(i[s]===t){i.splice(s,1);break}return this},function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype}(S,e=l),S.prototype.Emitter=e,S.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],S.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:10,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,locale:"EN",dicts:{},accept:function(e,t){return t()},init:function(){return i},forceFallback:!1,fallback:function(){var e,t,i,s,o,l;for(this.element.className=this.element.className+" tu-browser-not-supported",s=0,o=(l=this.element.getElementsByTagName("div")).length;s<o;s++)e=l[s],/(^| )tu-message($| )/.test(e.className)&&((t=e).className="tu-message");return t||(t=S.createElement('<div class="tu-message"><span></span></div>'),this.element.appendChild(t)),(i=t.getElementsByTagName("span")[0])&&(null!=i.textContent?i.textContent=this.options.dicts[this.options.locale].fallbackMessage:null!=i.innerText&&(i.innerText=this.options.dicts[this.options.locale].fallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,i={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},s=e.width/e.height;return this.options.thumbnailWidth||this.options.thumbnailHeight||(t=this.elementid,(t=$("#"+t))&&(this.options.thumbnailWidth=t.width())),i.optWidth=this.options.thumbnailWidth,i.optHeight=this.options.thumbnailHeight,null==i.optWidth&&null==i.optHeight?(i.optWidth=i.srcWidth,i.optHeight=i.srcHeight):null==i.optWidth?i.optWidth=s*i.optHeight:null==i.optHeight&&(i.optHeight=1/s*i.optWidth),t=i.optWidth/i.optHeight,e.height<i.optHeight||e.width<i.optWidth?(i.trgHeight=i.srcHeight,i.trgWidth=i.srcWidth):t<s?(i.srcHeight=e.height,i.srcWidth=i.srcHeight*t):(i.srcWidth=e.width,i.srcHeight=i.srcWidth/t),i.srcX=(e.width-i.srcWidth)/2,i.srcY=(e.height-i.srcHeight)/2,i},drop:function(e){return this.element.classList.remove("tu-drag-hover")},dragstart:i,dragend:function(e){return this.element.classList.remove("tu-drag-hover")},dragenter:function(e){return this.element.classList.add("tu-drag-hover")},dragover:function(e){return this.element.classList.add("tu-drag-hover")},dragleave:function(e){return this.element.classList.remove("tu-drag-hover")},paste:i,reset:function(){return this.element.classList.remove("tu-started")},addedfile:function(t){var e,i,s,o,l,r,n,a,p,u,d,c,h,m=(this.originalelement||this.element).getAttribute("id");this.element.classList.add("tu-started");var g,f,v,b,w,y,C=document.getElementById("tu-popup");if(this.options.uploadMultiple?C?((g=C.querySelector(".tu-popup-content"))&&(S.addClass(g,"tu-uploader-multiple-screen"),S.addClass(g,"tu-uploader-has-miltiple-img")),this.previewsContainer=C.querySelector(".tu-uploader-multiple-images"),t.previewElement||(t.previewElement=S.createElement(this.options.previewTemplate.trim()),v=this.previewsContainer.firstChild,0<(f=this.previewsContainer.childNodes.length)&&(1==this.previewsContainer.childNodes[f-1].nodeType?v=this.previewsContainer.childNodes[f-1]:1<f&&1==this.previewsContainer.childNodes[f-2].nodeType&&(v=this.previewsContainer.childNodes[f-2])),this.previewsContainer.insertBefore(t.previewElement,v)),t.previewElement.querySelector("[data-tu-uploadprogress]").style.width="0%",f=C.querySelectorAll(".tu-js-preview-item").length,v="",v="RU"==this.options.locale?"Вы выбрали "+f+" "+humanDigits(f,["файл","файла","файлов"]):1==f?"You've selected "+f+" file":"You've selected "+f+" files",C.querySelector(".tu-uploader-multiple-title").innerHTML=v,C.querySelector(".tu-uploader-multiple-nav-title").innerHTML=v):(b=document.getElementById(m+"-previews"))&&b.querySelector(".tu-popup-progressbar-steps")&&((w=b.querySelector("[data-tu-uploadprogress]"))&&(w.style.width="0%"),S.removeClass(b,"tu-popup-progressbar-completed"),S.removeClass(b,"tu-popup-progressbar-uploaded"),S.removeClass(b,"tu-popup-progressbar-error"),S.removeClass(b,"tu-popup-progressbar-start")):"IMG"==this.originalelement.nodeName?(this.previewsContainer=this.originalelement,this.originalelement.setAttribute("data-tu-thumbnail",""),S.setPositionForProgressLine($("#"+m))):"INPUT"==this.originalelement.nodeName?(b=document.getElementById(m+"-previews"))&&b.querySelector(".tu-popup-progressbar-steps")&&((w=(this.previewsContainer=b).querySelector("[data-tu-uploadprogress]"))&&(w.style.width="0%"),S.removeClass(b,"tu-popup-progressbar-uploaded"),S.removeClass(b,"tu-popup-progressbar-completed"),S.removeClass(b,"tu-popup-progressbar-error"),S.removeClass(b,"tu-popup-progressbar-start"),t.previewElement=this.previewsContainer):this.originalelement.getAttribute("bgimgfield")?(this.previewsContainer=this.originalelement.querySelector(".t-cover__carrier"),this.previewsContainer||(this.previewsContainer=this.originalelement),this.previewsContainer.setAttribute("data-tu-thumbnail",""),t.previewElement=this.previewsContainer):this.previewsContainer=null,this.previewsContainer){if(t.previewElement){for(t.previewTemplate=t.previewElement,o=0,n=(u=t.previewElement.querySelectorAll("[data-tu-name]")).length;o<n;o++)(e=u[o]).textContent=this._renameFilename(t.name),0<this.options.fileNameSize&&e.textContent.length>this.options.fileNameSize&&(e.textContent=e.textContent.substring(0,this.options.fileNameSize-3)+"...");for(l=0,a=(d=t.previewElement.querySelectorAll("[data-tu-size]")).length;l<a;l++)(e=d[l]).innerHTML=this.filesize(t.size);this.options.addRemoveLinks&&(t._removeLink=S.createElement('<a class="tu-remove" href="javascript:undefined;" data-tu-remove>'+this.options.dicts[this.options.locale].removeFile+"</a>"),t.previewElement.appendChild(t._removeLink))}if(y=this,i=function(e){return e.preventDefault(),e.stopPropagation(),t.status===S.UPLOADING?S.confirm(y.options.dicts[y.options.locale].cancelUploadConfirmation,function(){return y.removeFile(t)}):y.options.dicts[y.options.locale].removeFileConfirmation?S.confirm(y.options.dicts[y.options.locale].removeFileConfirmation,function(){return y.removeFile(t)}):y.removeFile(t)},h=[],t.previewElement)for(r=0,p=(c=t.previewElement.querySelectorAll("[data-tu-remove]")).length;r<p;r++)s=c[r],$(s).off("click"),h.push($(s).on("click",i)),$("#closelayer").click(function(e){$(t.previewElement).hasClass("tu-processing")&&i(e)}),$(document).keydown(function(e){27==e.keyCode&&$(t.previewElement).hasClass("tu-processing")&&i(e)});return h}},removedfile:function(e){var t;return e.previewElement&&void 0===e.url?null!=(t=e.previewElement)&&t.parentNode&&t.parentNode.removeChild(e.previewElement):""!==e.url&&e.status===S.ADDED&&null!=(t=e.previewElement)&&t.parentNode&&(e.previewElement.classList.remove("tu-processing"),e.previewElement.classList.remove("tu-image-preview"),e.previewElement.classList.add("tu-popup-progressbar-start"),this.emit("error",e,this.options.dicts[this.options.locale].uploadCanceled)),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var i,s,o,l;if(e.previewElement){for(e.previewElement.classList.remove("tu-file-preview"),s=0,o=(l=e.previewElement===this.options.originalelemet&&"IMG"==this.options.originalelement.nodeName.toUpperCase()||e.previewElement===this.previewsContainer&&this.options.originalelement.getAttribute("bgimgfield")?[e.previewElement]:e.previewElement.querySelectorAll("[data-tu-thumbnail]")).length;s<o;s++)"IMG"==(i=l[s]).nodeName.toUpperCase()?(i.alt=e.name,i.src=t):(i.style["background-image"]="url("+t+")",i.setAttribute("title",e.name));return setTimeout(function(){return e.previewElement.classList.add("tu-image-preview")},1)}},error:function(e,t){var i,s,o,l,r;if(this.options.uploadMultiple)e.previewElement&&-1<e.previewElement.className.indexOf("tu-uploader-multiple-img-item")&&((a=e.previewElement.querySelector(".tu-uploader-multiple-img-item-error-text"))||(a=S.createElement('<div class="tu-uploader-multiple-img-item-error-wrapper"> <div class="tu-uploader-multiple-img-item-error-icon"> <svg width="34px" height="34px" viewBox="0 0 34 34"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g transform="translate(-28.000000, 0.000000)" fill="#FF2E2E"> <g transform="translate(28.000000, 0.000000)"> <path d="M17,33.6458333 C7.79166667,33.6458333 0.354166667,26.2083333 0.354166667,17 C0.354166667,7.79166667 7.79166667,0.354166667 17,0.354166667 C26.2083333,0.354166667 33.6458333,7.79166667 33.6458333,17 C33.6458333,26.2083333 26.2083333,33.6458333 17,33.6458333 L17,33.6458333 Z M17,1.77083333 C8.57083333,1.77083333 1.77083333,8.57083333 1.77083333,17 C1.77083333,25.4291667 8.57083333,32.2291667 17,32.2291667 C25.4291667,32.2291667 32.2291667,25.4291667 32.2291667,17 C32.2291667,8.57083333 25.4291667,1.77083333 17,1.77083333 L17,1.77083333 Z"></path> <path d="M16.3625,21.1791667 L15.725,12.325 L15.725,8.64166667 L18.275,8.64166667 L18.275,12.325 L17.7083333,21.1791667 L16.3625,21.1791667 L16.3625,21.1791667 Z M15.7958333,25.3583333 L15.7958333,23.0208333 L18.1333333,23.0208333 L18.1333333,25.3583333 L15.7958333,25.3583333 L15.7958333,25.3583333 Z"></path> </g> </g> </g> </svg> </div> <div class="tu-uploader-multiple-img-item-error-text">Upload only images</div> </div>'),e.previewElement.appendChild(a),a=e.previewElement.querySelector(".tu-uploader-multiple-img-item-error-text")),a.innerHTML=t,S.addClass(e.previewElement,"tu-uploader-multiple-img-item-error"));else if(this.previewsContainer){this.previewsContainer.classList.add("tu-popup-progressbar-error");var n,a,p=this.previewsContainer.querySelector("[data-tu-errormessage]");p?(p.textContent=t,n="Upload error >",(a=this.previewsContainer.querySelector(".tu-popup-progressbar-error-title"))&&(void 0!==t&&(n=t),25<n.length&&(n=n.substring(0,23)+"..."),a.textContent=n)):((p=document.getElementById("tu-global-error-container"))||((p=S.createElement('<div id="tu-global-error-container" class="tu-bubble-box"><div class="tu-bubble-box__text"></div></div>')).style.display="none",document.body.appendChild(p)),p.childNodes[p.childNodes.length-1].innerHTML=t,p.style.display="block",window.setTimeout(function(){var e=document.getElementById("tu-global-error-container");e&&(e.style.display="none")},5e3));var u=this;window.setTimeout(function(){u.previewsContainer.classList.add("tu-popup-progressbar-start"),u.previewsContainer.classList.remove("tu-popup-progressbar-error")},5e3)}else if(e.previewElement)for(e.previewElement.classList.add("tu-error"),"String"!=typeof t&&t.error&&(t=t.error),r=[],s=0,o=(l=e.previewElement.querySelectorAll("[data-tu-errormessage]")).length;s<o;s++)i=l[s],r.push(i.textContent=t);this.onUserFail&&!this.options.uploadMultiple&&this.onUserFail.call(this,e,t)},errormultiple:function(e,t){console.log("["+this.elementid+"] errormultiple in "+e.length+", text: "+t),this.onUserFail&&this.options.uploadMultiple&&this.onUserFail.call(this,e,t)},processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("tu-processing"),e._removeLink))return e._removeLink.textContent=this.options.dicts[this.options.locale].cancelUpload},processingmultiple:i,uploadprogress:function(e,t,i){var s,o,l,r,n;if(e.previewElement){for(n=[],o=0,l=(r=e.previewElement.querySelectorAll("[data-tu-uploadprogress]")).length;o<l;o++)"PROGRESS"===(s=r[o]).nodeName?n.push(s.value=t):n.push(s.style.width=t+"%");return n}},totaluploadprogress:i,sending:i,sendingmultiple:i,success:function(e,t){var i,s,o=this;if(e.tuInfo||(e.tuInfo={}),e.previewElement){if(this.options.uploadMultiple&&t&&t.result)for(var l,r,n=0;n<t.result.length;n++)t.result[n].originalUrl==e.name&&(e.tuInfo=t.result[n],e.previewElement.setAttribute("data-tu-url",t.result[n].cdnUrl),(l=e.previewElement.querySelector("[data-tu-thumbnail]"))&&""<t.result[n].cdnUrl&&("IMG"==l.nodeName.toUpperCase()?l.setAttribute("src",t.result[n].cdnUrl):l.style["background-image"]="url("+t.result[n].cdnUrl+")"),r=e.previewElement,window.setTimeout(function(){var e=r.querySelector("[data-tu-uploadprogress]");e&&(e.style.width="0%")},500));else"IMG"==this.element.tagName&&t&&1==t.result.length?(e.tuInfo=t.result[0],this.element.setAttribute("src",t.result[0].cdnUrl),e.previewElement!=this.element.parentNode&&(e.previewElement.style.width="100%",e.previewElement.style.display="none",this.element.style.display="")):-1<this.previewsContainer.className.indexOf("tu-popup-progressbar-container")?((i=S.getElement("[data-tu-uploadprogress]","progressbar")).style.width="100%",S.addClass(o.previewsContainer,"tu-popup-progressbar-uploaded"),window.setTimeout(function(){S.removeClass(o.previewsContainer,"tu-processing"),S.removeClass(o.previewsContainer,"tu-popup-progressbar-uploaded"),S.addClass(o.previewsContainer,"tu-popup-progressbar-completed"),i.style.width="0%"},500)):this.element.getAttribute("bgimgfield")&&((s=this.element.querySelector(".t-cover__carrier"))?s.style["background-image"]="url("+t.result[0].cdnUrl+")":this.element.style["background-image"]="url("+t.result[0].cdnUrl+")",this.element.setAttribute("data-tu-value",t.result[0].cdnUrl));return e.previewElement.classList.add("tu-success")}},successmultiple:i,canceled:function(e){return this.emit("error",e,this.options.dicts[this.options.locale].uploadCanceled)},canceledmultiple:i,complete:function(e){if(e._removeLink&&(e._removeLink.textContent=this.options.dicts[this.options.locale].removeFile),e.previewElement)return e.previewElement.classList.add("tu-complete")},completemultiple:i,maxfilesexceeded:i,maxfilesreached:i,queuecomplete:i,addedfiles:i,previewTemplate:'<div class="tu-preview tu-file-preview" style="width: 180px; float: left; overflow:hidden;"><div class="tu-details dztemplate" style="display:block;position: relative; width: 180px; padding: 5px; overflow: hidden;"> <img data-tu-thumbnail /> <div class="tu-filename"><span data-tu-name id="filenamer"></span></div> <div class="tu-size" data-tu-size></div> <div class="tu-remove-file" data-tu-remove><div class="tu-close"></div></div> </div> <div class="tu-progress" style=""><span class="tu-upload" data-tu-uploadprogress></span></div> <div class="tu-success-mark" style="display:none;"><span>✔</span></div> <div class="tu-error-mark" style="display:none;"><span>✘</span></div><div class="tu-error-message" style="display:none;"><span data-tu-errormessage></span></div></div>'},W=function(){for(var e,t,i,s=arguments[0],o=2<=arguments.length?a.call(arguments,1):[],l=0,r=o.length;l<r;l++)for(e in t=o[l])i=t[e],s[e]=i;return s},S.prototype.getAcceptedFiles=function(){for(var e,t=this.files,i=[],s=0,o=t.length;s<o;s++)(e=t[s]).accepted&&i.push(e);return i},S.prototype.getRejectedFiles=function(){for(var e,t=this.files,i=[],s=0,o=t.length;s<o;s++)(e=t[s]).accepted||i.push(e);return i},S.prototype.getFilesWithStatus=function(e){for(var t,i=this.files,s=[],o=0,l=i.length;o<l;o++)(t=i[o]).status===e&&s.push(t);return s},S.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(S.QUEUED)},S.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(S.UPLOADING)},S.prototype.getAddedFiles=function(){return this.getFilesWithStatus(S.ADDED)},S.prototype.getActiveFiles=function(){for(var e,t=this.files,i=[],s=0,o=t.length;s<o;s++)(e=t[s]).status!==S.UPLOADING&&e.status!==S.QUEUED||i.push(e);return i},S.prototype.init=function(){var e,i,o,t,s,l,r,n,a,p,u,d,c,h,m,g,f,v,b;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("tildaupload")&&!this.element.querySelector(".tu-message")&&this.element.appendChild(S.createElement('<div class="tu-default tu-message"><span>'+this.options.dicts[this.options.locale].defaultMessage+"</span></div>")),n=this,(o=function(){n.hiddenFileInput&&n.hiddenFileInput.parentNode.removeChild(n.hiddenFileInput),n.hiddenFileInput=document.createElement("input"),n.hiddenFileInput.setAttribute("type","file"),(null==n.options.maxFiles||1<n.options.maxFiles)&&n.hiddenFileInput.setAttribute("multiple","multiple"),n.hiddenFileInput.className="tu-hidden-input",null!=n.options.acceptedFiles&&n.hiddenFileInput.setAttribute("accept",n.options.acceptedFiles),null!=n.options.capture&&n.hiddenFileInput.setAttribute("capture",n.options.capture),n.hiddenFileInput.style.visibility="hidden",n.hiddenFileInput.style.position="absolute",n.hiddenFileInput.style.top="0",n.hiddenFileInput.style.left="0",n.hiddenFileInput.style.height="0",n.hiddenFileInput.style.width="0";var e=null;return"string"==typeof n.options.hiddenInputContainer?e=document.querySelector(n.options.hiddenInputContainer):n.options.hiddenInputContainer&&null!=n.options.hiddenInputContainer.nodeType&&(e=n.options.hiddenInputContainer),(e=e||document.querySelector("body")).appendChild(n.hiddenFileInput),n.hiddenFileInput.addEventListener("change",function(){var e,t,i,s=n.hiddenFileInput.files;if(s.length)for(t=0,i=s.length;t<i;t++)e=s[t],n.addFile(e);return n.emit("addedfiles",s),o()})})(),this.URL=null!=(l=window.URL)?l:window.webkitURL,t=0,s=(r=this.events).length;t<s;t++)e=r[t],this.on(e,this.options[e]);return this.on("uploadprogress",(a=this,function(){return a.updateTotalUploadProgress()})),this.on("removedfile",(p=this,function(){return p.updateTotalUploadProgress()})),this.on("canceled",(u=this,function(e){return u.emit("complete",e)})),this.on("complete",(d=this,function(e){if(0===d.getAddedFiles().length&&0===d.getUploadingFiles().length&&0===d.getQueuedFiles().length)return setTimeout(function(){return d.emit("queuecomplete")},0)})),i=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return v.emit("dragstart",e)},dragenter:function(e){return i(e),f.emit("dragenter",e)},dragover:function(e){var t;try{t=e.dataTransfer.effectAllowed}catch(e){}return e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",i(e),g.emit("dragover",e)},dragleave:function(e){return m.emit("dragleave",e)},drop:function(e){return i(e),h.drop(e)},dragend:(c=h=m=g=f=v=this,function(e){return c.emit("dragend",e)})}}],0<this.clickableElements.length&&this.clickableElements.forEach((b=this,function(t){return b.listeners.push({element:t,events:{click:function(e){return t===b.element&&e.target!==b.element&&!S.elementInside(e.target,b.element.querySelector(".tu-message"))||b.hiddenFileInput.click(),!0}}})})),this.enable(),this.options.init.call(this)},S.prototype.enableAddDropZone=function(){if(this.options.additionalDropzone){"string"==typeof this.options.additionalDropzone&&(this.options.additionalDropzone=[this.options.additionalDropzone]);for(var e=0;e<this.options.additionalDropzone.length;e++){var i,s,o,t,l,r,n,a=this.options.additionalDropzone[e];if(addDropZone=S.getElement(a,"addDropZone"),addDropZone)for(this.clickableElements=[addDropZone.querySelector(".tu-clickable")],noPropagation=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},a={element:addDropZone,events:{dragstart:function(t){return function(e){return t.emit("dragstart",e)}}(this),dragenter:function(t){return function(e){return noPropagation(e),t.emit("dragenter",e)}}(this),dragover:function(i){return function(e){var t;try{t=e.dataTransfer.effectAllowed}catch(e){}return e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",noPropagation(e),i.emit("dragover",e)}}(this),dragleave:function(t){return function(e){return t.emit("dragleave",e)}}(this),drop:function(t){return function(e){return noPropagation(e),t.drop(e)}}(this),dragend:function(t){return function(e){return t.emit("dragend",e)}}(this)}},this.listeners.push(a),addDropZone.querySelector(".tu-clickable")?(this.addClickableElements=[addDropZone.querySelector(".tu-clickable")],addClickElem={element:this.addClickableElements[0],events:{click:function(t){var i=t.addClickableElements[0];return function(e){return i===t.element&&e.target!==t.element&&!S.elementInside(e.target,t.element.querySelector(".tu-message"))||t.hiddenFileInput.click(),!0}}(this)}},this.listeners.push(addClickElem)):addClickElem=null,n=[],t=0,l=(r=addClickElem?[a,addClickElem]:[a]).length;t<l;t++)i=r[t],n.push(function(){var e=i.events,t=[];for(s in e)o=e[s],t.push(i.element.addEventListener(s,o,!1));return t}())}}},S.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),null!=(e=this.hiddenFileInput)&&e.parentNode&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.tildaupload,S.instances.splice(S.instances.indexOf(this),1)},S.prototype.updateTotalUploadProgress=function(){var e,t,i,s,o,l=0,r=0;if(this.getActiveFiles().length){for(i=0,s=(o=this.getActiveFiles()).length;i<s;i++)l+=(e=o[i]).upload.bytesSent,r+=e.upload.total;t=100*l/r}else t=100;return this.emit("totaluploadprogress",t,r,l)},S.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},S.prototype._renameFilename=function(e){return"function"!=typeof this.options.renameFilename?e:this.options.renameFilename(e)},S.prototype.getFallbackForm=function(){var e,t;return(e=this.getExistingFallback())?e:(e='<div class="tu-fallback">',this.options.dicts[this.options.locale].fallbackText&&(e+="<p>"+this.options.dicts[this.options.locale].fallbackText+"</p>"),e+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',e=S.createElement(e),"FORM"!==this.element.tagName?(t=S.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(e):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=t?t:e)},S.prototype.getExistingFallback=function(){for(var e,t=function(e){for(var t,i=0,s=e.length;i<s;i++)if(t=e[i],/(^| )fallback($| )/.test(t.className))return t},i=["div","form"],s=0,o=i.length;s<o;s++)if(e=i[s],e=t(this.element.getElementsByTagName(e)))return e},S.prototype.setupEventListeners=function(){for(var i,s,o,e=this.listeners,t=[],l=0,r=e.length;l<r;l++)i=e[l],t.push(function(){var e=i.events,t=[];for(s in e)o=e[s],null!==i.element&&t.push(i.element.addEventListener(s,o,!1));return t}());return t},S.prototype.removeEventListeners=function(){for(var i,s,o,e=this.listeners,t=[],l=0,r=e.length;l<r;l++)i=e[l],t.push(function(){var e=i.events,t=[];for(s in e)o=e[s],t.push(i.element.removeEventListener(s,o,!1));return t}());return t},S.prototype.disable=function(){var e,t,i,s,o;for(this.clickableElements.forEach(function(e){return e.classList.remove("tu-clickable")}),this.removeEventListeners(),o=[],t=0,i=(s=this.files).length;t<i;t++)e=s[t],o.push(this.cancelUpload(e));return o},S.prototype.enable=function(){return this.clickableElements.forEach(function(e){if(null!==e)return e.classList.add("tu-clickable")}),this.setupEventListeners()},S.prototype.filesize=function(e){var t,i,s,o,l,r=0,n="b";if(0<e){for(t=o=0,l=(s=["TB","GB","MB","KB","b"]).length;o<l;t=++o)if(i=s[t],Math.pow(this.options.filesizeBase,4-t)/10<=e){r=e/Math.pow(this.options.filesizeBase,4-t),n=i;break}return"<strong>"+(r=Math.round(10*r)/10)+"</strong> "+n}return""},S.prototype.sizeUploadedFiles=function(){var e,t=0,i="";if(this.files&&0<this.files.length){for(e=0;e<this.files.length;e++)t+=this.files[e].size;if(1024<t&&(i="Kb",1024<(t=parseFloat(t/1024))&&(t=parseFloat(t/1024),i="Mb")),0<t)return"<strong>"+(t=(t=""+t).substring(0,4))+"</strong> "+i}return""},S.prototype._updateMaxFilesReachedClass=function(){return this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles&&0<this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("tu-max-files-reached")):this.element.classList.remove("tu-max-files-reached")},S.prototype.drop=function(e){var t,i,s,o,l;if(e.dataTransfer)if(this.emit("drop",e),t=e.dataTransfer.files,this.emit("addedfiles",t),t.length)(i=e.dataTransfer.items)&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t);else if(e.dataTransfer.types&&0<e.dataTransfer.types.length)for(s in e.dataTransfer.types)if(o=e.dataTransfer.types[s],(0<o.indexOf("url")||0<o.indexOf("uri-"))&&""<(l=e.dataTransfer.getData(o))){this._addFilesFromItems([{url:l}]);break}},S.prototype.paste=function(e){var t;if(null!=(null!=e&&null!=(t=e.clipboardData)?t.items:void 0))return this.emit("paste",e),(e=e.clipboardData.items).length?this._addFilesFromItems(e):void 0},S.prototype.handleFiles=function(e){for(var t,i=[],s=0,o=e.length;s<o;s++)t=e[s],i.push(this.addFile(t));return i},S.prototype._addFilesFromItems=function(e){for(var t,i,s=[],o=0,l=e.length;o<l;o++)null!=(i=e[o]).webkitGetAsEntry&&(t=i.webkitGetAsEntry())?t.isFile?s.push(this.addFile(i.getAsFile())):t.isDirectory?s.push(this._addFilesFromDirectory(t,t.name)):s.push(void 0):null!=i.getAsFile?null==i.kind||"file"===i.kind?s.push(this.addFile(i.getAsFile())):s.push(void 0):""<i.url?this.uploadFileFromURL(i.url):s.push(void 0);return s},S.prototype._addFilesFromDirectory=function(e,o){var l,r,t=e.createReader(),i=function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0};return r=this,(l=function(){return t.readEntries(function(e){var t,i,s;if(0<e.length){for(i=0,s=e.length;i<s;i++)(t=e[i]).isFile?t.file(function(e){if(!r.options.ignoreHiddenFiles||"."!==e.name.substring(0,1))return e.fullPath=o+"/"+e.name,r.addFile(e)}):t.isDirectory&&r._addFilesFromDirectory(t,o+"/"+t.name);l()}return null},i)})()},S.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dicts[this.options.locale].fileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):S.isValidFile(e,this.options.acceptedFiles)?this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles&&0<this.options.maxFiles?(t(this.options.dicts[this.options.locale].maxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dicts[this.options.locale].invalidFileType)},S.prototype.addFile=function(t){return t.upload={progress:0,total:t.size,bytesSent:0},this.files.push(t),t.status=S.ADDED,this.emit("addedfile",t),this._enqueueThumbnail(t),this.accept(t,(i=this,function(e){return e?(t.accepted=!1,i._errorProcessing([t],e)):(t.accepted=!0,i.options.autoQueue&&i.enqueueFile(t)),i._updateMaxFilesReachedClass()}));var i},S.prototype.enqueueFiles=function(e){for(var t,i=0,s=e.length;i<s;i++)t=e[i],this.enqueueFile(t);return null},S.prototype.enqueueFile=function(e){if(e.status!==S.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=S.QUEUED,this.options.autoProcessQueue)return setTimeout((t=this,function(){return t.processQueue()}),0);var t},S.prototype._thumbnailQueue=[],S.prototype._processingThumbnail=!1,S.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout((t=this,function(){return t._processThumbnailQueue()}),0);var t},S.prototype._processThumbnailQueue=function(){var e;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),(e=this,function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}))},S.prototype.removeFile=function(e){if(e.status===S.UPLOADING&&this.cancelUpload(e),this.files=s(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},S.prototype.removeAllFiles=function(e){var t,i,s,o;for(null==e&&(e=!1),i=0,s=(o=this.files.slice()).length;i<s;i++)(t=o[i]).status===S.UPLOADING&&!e||(t.previewElement&&-1<t.previewElement.className.indexOf("tu-popup-progressbar-container")&&(t.previewElement=!1),this.removeFile(t));return null},S.prototype.createThumbnail=function(e,t){var i,s=new FileReader;return s.onload=(i=this,function(){return"image/svg+xml"===e.type?(i.emit("thumbnail",e,s.result),void(null!=t&&t())):i.createThumbnailFromUrl(e,s.result,t)}),s.readAsDataURL(e)},S.prototype.createThumbnailFromUrl=function(s,e,o,t){var l,r=document.createElement("img");return t&&(r.crossOrigin=t),r.onload=(l=this,function(){var e,t,i;if(s.width=r.width,s.height=r.height,null==(e=l.options.resize.call(l,s)).trgWidth&&(e.trgWidth=e.optWidth),null==e.trgHeight&&(e.trgHeight=e.optHeight),i=(t=document.createElement("canvas")).getContext("2d"),t.width=e.trgWidth,t.height=e.trgHeight,n(i,r,null!=(i=e.srcX)?i:0,null!=(i=e.srcY)?i:0,e.srcWidth,e.srcHeight,null!=(i=e.trgX)?i:0,null!=(i=e.trgY)?i:0,e.trgWidth,e.trgHeight),t=t.toDataURL("image/png"),l.emit("thumbnail",s,t),null!=o)return o()}),null!=o&&(r.onerror=o),r.src=e},S.prototype.processQueue=function(){var e,t=this.options.parallelUploads,i=this.getUploadingFiles().length,s=i;if(!(t<=i)&&0<(e=this.getQueuedFiles()).length){if(this.options.uploadMultiple)return this.processFiles(e.slice(0,t-i));for(;s<t;){if(!e.length)return;this.processFile(e.shift()),s++}}},S.prototype.processFile=function(e){return this.processFiles([e])},S.prototype.processFiles=function(e){for(var t,i=0,s=e.length;i<s;i++)(t=e[i]).processing=!0,t.status=S.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},S.prototype._getFilesWithXhr=function(o){var l;return function(){for(var e=this.files,t=[],i=0,s=e.length;i<s;i++)(l=e[i]).xhr===o&&t.push(l);return t}.call(this)},S.prototype.cancelUpload=function(e){var t,i,s,o,l,r,n;if(e.status===S.UPLOADING){for(s=0,l=(i=this._getFilesWithXhr(e.xhr)).length;s<l;s++)(t=i[s]).status=S.CANCELED;for(e.xhr.abort(),o=0,r=i.length;o<r;o++)t=i[o],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(n=e.status)!==S.ADDED&&n!==S.QUEUED||(e.status=S.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},P=function(){var e=arguments[0],t=2<=arguments.length?a.call(arguments,1):[];return"function"==typeof e?e.apply(this,t):e},S.prototype.uploadFile=function(e){return this.uploadFiles([e])},S.prototype.uploadFiles=function(u){for(var d,e,i,t,s,o,l,r,n,a,p,c,h,m,g,f,v,b,w,y,C,U,F,T,E,k,x,L,$=new XMLHttpRequest,A=0,N=u.length;A<N;A++)(d=u[A]).xhr=$;p=P(this.options.method,u);var _,I,D,M="";for(t in 0<this.element.getAttribute("data-tu-max-width")&&(M+="&maxwidth="+parseInt(this.element.getAttribute("data-tu-max-width"))),0<this.element.getAttribute("data-tu-max-height")&&(M+="&maxheight="+parseInt(this.element.getAttribute("data-tu-max-height"))),this.element.getAttribute("data-tu-cover")&&""!=this.element.getAttribute("data-tu-cover")&&(M+="&crop="+this.element.getAttribute("data-tu-cover")),g=P(this.options.url,u),$.open(p,g+M,!0),$.withCredentials=!!this.options.withCredentials,h=null,i=function(){for(var e=[],t=0,i=u.length;t<i;t++)d=u[t],0==$.status?e.push(_._errorProcessing(u,h||_.options.dicts[_.options.locale].bigFileError,$)):e.push(_._errorProcessing(u,h||_.options.dicts[_.options.locale].responseError.replace("{{statusCode}}",$.status),$));return e},I=_=this,m=function(e){var t,i,s,o,l,r,n,a,p;if(null!=e)for(i=100*e.loaded/e.total,s=0,r=u.length;s<r;s++)(d=u[s]).upload={progress:i,total:e.total,bytesSent:e.loaded};else{for(t=!0,i=100,o=0,n=u.length;o<n;o++)100===(d=u[o]).upload.progress&&d.upload.bytesSent===d.upload.total||(t=!1),d.upload.progress=i,d.upload.bytesSent=d.upload.total;if(t)return}for(p=[],l=0,a=u.length;l<a;l++)d=u[l],p.push(I.emit("uploadprogress",d,i,d.upload.bytesSent));return p},$.onload=(D=this,function(t){var e;if(u[0].status!==S.CANCELED&&4===$.readyState){if(h=$.responseText,$.getResponseHeader("content-type")&&~$.getResponseHeader("content-type").indexOf("application/json"))try{h=JSON.parse(h)}catch(e){t=e,h="Invalid JSON response from server."}return m(),200<=(e=$.status)&&e<300?D._finished(u,h,t):i()}}),$.onerror=function(){if(u[0].status!==S.CANCELED)return i()},(null!=(M=$.upload)?M:$).onprogress=m,o={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&W(o,this.options.headers),o)(s=o[t])&&$.setRequestHeader(t,s);if(e=new FormData,window.Tildaupload_PUBLICKEY&&e.append("publickey",window.Tildaupload_PUBLICKEY),window.Tildaupload_UPLOADKEY&&e.append("uploadkey",window.Tildaupload_UPLOADKEY),"y"===window.Tildaupload_BIG&&e.append("big","y"),this.options.params)for(a in T=this.options.params)f=T[a],e.append(a,f);for(v=0,y=u.length;v<y;v++)d=u[v],this.emit("sending",d,$,e);if(this.options.uploadMultiple&&this.emit("sendingmultiple",u,$,e),"FORM"===this.element.tagName)for(b=0,C=(E=this.element.querySelectorAll("input, textarea, select, button")).length;b<C;b++)if(n=(r=E[b]).getAttribute("name"),x=r.getAttribute("type"),"SELECT"===r.tagName&&r.hasAttribute("multiple"))for(w=0,U=(k=r.options).length;w<U;w++)(c=k[w]).selected&&e.append(n,c.value);else(!x||"checkbox"!==(x=x.toLowerCase())&&"radio"!==x||r.checked)&&e.append(n,r.value);for(l=F=0,L=u.length-1;0<=L?F<=L:L<=F;l=0<=L?++F:--F)e.append(this._getParamName(l),u[l],this._renameFilename(u[l].name));return this.submitRequest($,e,u)},S.prototype.submitRequest=function(e,t,i){return e.send(t)},S.prototype._finished=function(e,t,i){for(var s,o,l,r=0,n=0,a=e.length;n<a;n++){if(s=e[n],l="",t&&t.errorExists&&t.result&&0<t.errorExists)for(o=0;o<t.result.length;o++){if(l=t.result[o],s.name==l.originalUrl||null==s.name&&"blob"==l.originalUrl){s.tuInfo=t.result[o];break}l=""}l&&l.error?(s.status=S.ERROR,this.emit("error",s,l.error,i),r=1):(s.status=S.SUCCESS,this.emit("success",s,t,i)),this.emit("complete",s)}if(this.options.uploadMultiple&&(r?this.emit("errormultiple",e,t,i):this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},S.prototype._errorProcessing=function(e,t,i){for(var s,o=0,l=e.length;o<l;o++)(s=e[o]).status=S.ERROR,this.emit("error",s,t,i),this.emit("complete",s);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},S.prototype.uploadFileFromURL=function(n){var e,a=(this.originalelement||this.element).getAttribute("id"),p=this,t=n.split("\n");t&&1<t.length&&(n=t[0]);t={url:n,name:n,size:""};t.upload={progress:0,total:t.size,bytesSent:0},p.files.push(t),t.status=S.ADDED,p.emit("addedfile",t);t="";0<this.element.getAttribute("data-tu-max-width")&&(t+="&maxwidth="+parseInt(this.element.getAttribute("data-tu-max-width"))),0<this.element.getAttribute("data-tu-max-height")&&(t+="&maxheight="+parseInt(this.element.getAttribute("data-tu-max-height"))),this.element.getAttribute("data-tu-cover")&&""!=this.element.getAttribute("data-tu-cover")&&(t+="&crop="+this.element.getAttribute("data-tu-cover")),e="no"==this.element.getAttribute("data-tu-is-image")?""<this.element.getAttribute("data-tu-accepted-files")?this.element.getAttribute("data-tu-accepted-files"):"no":"image/*",$.ajax({url:this.options.url+t,type:"POST",dataType:"text",timeout:1e4,data:{url:n,publickey:Tildaupload_PUBLICKEY,uploadkey:Tildaupload_UPLOADKEY,acceptedFiles:e},beforeSend:function(){$("#"+a+"-previews").css({display:"inline-block"});var e=$("#"+a+"-previews");0<e.length&&e.removeClass("tu-popup-progressbar-error").removeClass("tu-popup-progressbar-completed").removeClass("tu-popup-progressbar-uploaded").removeClass("tu-popup-progressbar-start"),TUWidget.hideUploader()},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&(t=Math.ceil(e.loaded/e.total*100),p.emit("progress",t,e.loaded))},!1),e},success:function(e){e&&"string"==typeof e&&"{"==e.substring(0,1)?e=$.parseJSON(e):console.log(e);$("#tu-popup");var t=$("#"+a);if(e&&e.result&&""<e.result[0].cdnUrl)return p._finished(p.files,e),!0;var i=t.data("tildaupload"),s=$("#"+a+"-previews");if(0<s.length){s.removeClass("tu-popup-progressbar-completed"),s.removeClass("tu-popup-progressbar-success"),s.removeClass("tu-popup-progressbar-start"),s.addClass("tu-popup-progressbar-error");var o,l="",r="Upload error >";if(e&&e.result&&e.result[0])for(o in e.result)e.result[o].error&&""<e.result[o].error&&(l+=e.result[o].error+"<br>");""==l&&(l="Upload only image files"),r=25<l.length?l.substring(0,23)+"...":l,s.find(".tu-popup-progressbar-error-title").html(r),s.find(".tu-popup-progressbar-error-text").html(l),window.setTimeout(function(){s.removeClass("tu-popup-progressbar-error"),s.addClass("tu-popup-progressbar-start")},5e3)}else 0<$("#"+a+"-progress").length&&(S.setPositionForProgressLine(t),$("#"+a+"-progress").css({background:"#FF2222"}));null!=i&&void 0!==i&&i.onUserFail&&!i.options.uploadMultiple&&i.onUserFail.call(i,n,e)},error:function(e){console.log("error"),console.log(e);var t=$("#"+a).data("tildaupload");null!=t&&void 0!==t&&t.onUserFail&&!t.options.uploadMultiple&&t.onUserFail.call(t,n,e)}})},S.prototype.done=function(e){return this.onUserDone=e,this},S.prototype.fail=function(e){return this.onUserFail=e,this},S.prototype.progress=function(e){return this.onUserProgress=e,this},(r=S).version="4.3.0",r.options={},r.optionsForElement=function(e){if(e.getAttribute("id"))return r.options[t(e.getAttribute("id"))]},r.instances=[],r.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.tildaupload:void 0))throw new Error("No Tildaupload found for given element. This is probably because you're trying to access it before Tildaupload had the time to initialize. Use the `init` option to setup any additional observers on your Tildaupload.");return e.tildaupload},r.autoDiscover=!0,r.discover=function(){var e,t,l,i,s,o;for(document.querySelectorAll?l=document.querySelectorAll(".tildaupload"):(l=[],(e=function(e){for(var t,i=[],s=0,o=e.length;s<o;s++)t=e[s],/(^| )tildaupload($| )/.test(t.className)?i.push(l.push(t)):i.push(void 0);return i})(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))),o=[],i=0,s=l.length;i<s;i++)t=l[i],!1!==r.optionsForElement(t)?o.push(new r(t)):o.push(void 0);return o},r.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],r.isBrowserSupported=function(){var e,t,i,s=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(e=0,t=(i=r.blacklistedBrowsers).length;e<t;e++)i[e].test(navigator.userAgent)&&(s=!1);else s=!1;else s=!1;return s},s=function(e,t){for(var i,s=[],o=0,l=e.length;o<l;o++)(i=e[o])!==t&&s.push(i);return s},t=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},r.createElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},r.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},r.addClass=function(e,t){var i;"string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),i&&(i.classList?i.classList.add(t):-1<i.className.indexOf(t)&&(i.className+=t))},r.setPositionForProgressLine=function(e){var t=e.position(),i=e.offset(),s=e.attr("id");return 0<$("#"+s+"-progress").length&&(""<e.attr("bgimgfield")||e.hasClass("tn-atom__img")?$("#"+s+"-progress").css({width:parseInt(e.width())+"px"}):$("#"+s+"-progress").css({top:parseInt(t.top+e.height())+"px",left:i.left+"px",width:parseInt(e.width())+"px"})),e},r.removeClass=function(e,t){var i;"string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),i&&(i.classList?i.classList.remove(t):i.className=i.className.replace("/\b"+t+"/g",""))},r.getElement=function(e,t){var i;if("string"==typeof e?null==(i=document.querySelector(e))&&jQuery&&(i=0<(i=jQuery(e)).length?i.get(0):null):null!=e.nodeType&&(i=e),null==i)throw new Error("Invalid `"+t+"` option provided. Element is `"+e+"`, typeof is `"+typeof e+"`. Please provide a CSS selector or a plain HTML element.");return i},r.getElements=function(e,t){var i,s,o,l,r,n,a;if(e instanceof Array){s=[];try{for(o=0,r=e.length;o<r;o++)i=e[o],s.push(this.getElement(i,t))}catch(e){s=null}}else if("string"==typeof e)for(s=[],l=0,n=(a=document.querySelectorAll(e)).length;l<n;l++)i=a[l],s.push(i);else null!=e.nodeType&&(s=[e]);if(null==s||!s.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return s},r.confirm=function(e,t,i){return window.confirm(e)?t():null!=i?i():void 0},r.isValidFile=function(e,t){var i,s,o,l,r;if(!t)return!0;for(t=t.split(","),i=(s=e.type).replace(/\/.*$/,""),l=0,r=t.length;l<r;l++)if("."===(o=(o=t[l]).trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(o.toLowerCase(),e.name.length-o.length))return!0}else if(/\/\*$/.test(o)){if(i===o.replace(/\/.*$/,""))return!0}else if(s===o)return!0;return!1},r.animate=function(i,s,e,o){var t,l,r,n="slow"==e?500:"fast"==e?17:0<e?e:100;for(cssName in s)void 0!==i.style[cssName]&&(s[cssName].start||(s[cssName].start=0),s[cssName].start<s[cssName].end?s[cssName].step=Math.abs(s[cssName].step):s[cssName].step=-Math.abs(s[cssName].step),i.style[cssName]=s[cssName].start,t=(l=""+s[cssName].start).length,"px"==(l=l.substring(t-2))?s[cssName].unit="px":"pt"==l?s[cssName].unit="pt":"%"==l.substring(1)?s[cssName].unit="%":s[cssName].unit="");!function e(){var t=!0;for(cssName in s)void 0!==i.style[cssName]&&(s[cssName].start<s[cssName].end&&i.style[cssName]<s[cssName].end||s[cssName].start>s[cssName].end&&i.style[cssName]>s[cssName].end)&&(r=0<s[cssName].step&&s[cssName].step<1?parseFloat(i.style[cssName])+parseFloat(s[cssName].step):parseInt(i.style[cssName])+parseInt(s[cssName].step),i.style[cssName]=r+s[cssName].unit,t=!1);t?"function"==typeof o&&o(i):setTimeout(function(){window.reqAnimationFrame(e)},n)}()},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.tildaupload=function(e){return this.each(function(){return new r(this,e)})}),"undefined"!=typeof module&&null!==module?module.exports=r:window.Tildaupload=r,r.ADDED="added",r.QUEUED="queued",r.ACCEPTED=r.QUEUED,r.UPLOADING="uploading",r.PROCESSING=r.UPLOADING,r.CANCELED="canceled",r.ERROR="error",r.SUCCESS="success",d=function(e){e.naturalWidth;var t,i,s,o,l=e.naturalHeight,r=document.createElement("canvas");for(r.width=1,r.height=l,(r=r.getContext("2d")).drawImage(e,0,0),t=r.getImageData(0,0,1,l).data,o=0,s=i=l;o<s;)0===t[4*(s-1)+3]?i=s:o=s,s=i+o>>1;return 0==(l=s/l)?1:l},n=function(e,t,i,s,o,l,r,n,a,p){var u=d(t);return e.drawImage(t,i,s,o,l,r,n,a,p/u)},e=function(t,i){var s=!1,e=!0,o=t.document,l=o.documentElement,r=o.addEventListener?"addEventListener":"attachEvent",n=o.addEventListener?"removeEventListener":"detachEvent",a=o.addEventListener?"":"on",p=function(e){if("readystatechange"!==e.type||"complete"===o.readyState)return("load"===e.type?t:o)[n](a+e.type,p,!1),!s&&(s=!0)?i.call(t,e.type||e):void 0},u=function(){try{l.doScroll("left")}catch(e){return void setTimeout(u,50)}return p("poll")};if("complete"!==o.readyState){if(o.createEventObject&&l.doScroll){try{e=!t.frameElement}catch(e){}e&&u()}return o[r](a+"DOMContentLoaded",p,!1),o[r](a+"readystatechange",p,!1),t[r](a+"load",p,!1)}},r._autoDiscoverFunction=function(){if(r.autoDiscover)return r.discover()},e(window,r._autoDiscoverFunction)}.call(this),$(document).ready(function(){Tildaupload_URL="https://upload.tildacdn.com/api/upload/",TUWidget={urlUploadAPI:Tildaupload_URL,locale:"EN",dicts:{EN:{defaultMessage:"Drop files here to upload",fallbackMessage:"Your browser does not support drag'n'drop file uploads.",fallbackText:"Please use the fallback form below to upload your files like in the olden days.",fileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",invalidFileType:"You can't upload files of this type.",responseError:"Server responded with {{statusCode}} code.",cancelUpload:"Cancel upload",cancelUploadConfirmation:"Are you sure you want to cancel this upload?",removeFile:"Remove file",removeFileConfirmation:null,removeAll:"Remove All",browseFiles:"Browse files",fileFromTheWeb:"File from the web",maxFilesExceeded:"You can not upload any more files.",buttonUploadLink:"Upload",buttonUpload:"Upload file",buttonUploads:"Upload files",buttonUploadImage:"Upload image",buttonUploadImages:"Upload images",backToLocalUpload:"Back to local upload",uploadToLink:"Upload from URL",uploadToPaste:"Paste",attentionToLink:"Grab any file off the web. Just provide the link",pasteLink:"Paste your link here",uploading:"Uploading...",uploadSelected:"Upload selected",selected:"You’ve selected {cnt} files",settings:{big:"Enable 1920px wide image uploading",attentionToBig:"By default, images are resized to 1680px. Wider images increase page load time and negatively affect SEO, conversion rates, and user experience"},uploadCanceled:"Upload canceled"},RU:{defaultMessage:"Бросьте файл сюда для загрузки",fallbackMessage:"Ваш браузер не поддерживает drag'n'drop",fallbackText:"Please use the fallback form below to upload your files like in the olden days",fileTooBig:"Файл слишком большой ({{filesize}}MiB). Максимальный размер: {{maxFilesize}}MiB",invalidFileType:"Вы не можете загрузить файл этого типа",responseError:"Сервер получил ответ {{statusCode}} код.",cancelUpload:"Отмена загрузки",cancelUploadConfirmation:"Вы действительно хотите отменить загрузку?",removeFile:"Удалить файл",removeFileConfirmation:null,removeAll:"Удалить все",browseFiles:"Посмотреть файлы",maxFilesExceeded:"Вы не можете больше загружать файлы",fileFromTheWeb:"Файл по ссылке",buttonUploadLink:"Загрузить",buttonUpload:"Загрузить файл",buttonUploads:"Загрузить файлы",buttonUploadImage:"Загрузить изображение",buttonUploadImages:"Загрузить изображения",uploadToLink:"Загрузка по ссылке",uploadToPaste:"Вставить",backToLocalUpload:"Вернуться к загрузке файлов с компьютера",attentionToLink:"Загрузите любой файл из сети. Просто укажите ссылку",pasteLink:"Вставьте ссылку сюда",uploading:"Загрузка...",uploadSelected:"Загрузить выбранное",selected:"Вы выбрали {cnt}",settings:{big:"Разрешить загрузку до 1920px",attentionToBig:"По умолчанию загруженные изображения сжимаются до 1680px. При использовании опции страницы могут загружаться медленнее, что может негативно повлиять на SEO, конверсию и опыт использования сайта"},uploadCanceled:"Загрузка отменена"}},settings:{big:""}},"RU"==$("body").data("lang")?TUWidget.locale="RU":TUWidget.locale="EN",Tildaupload.autoDiscover=!1,document.cookie.split(";").some(function(e){return 0<=e.trim().indexOf("Tildaupload_BIG=y")})?(window.Tildaupload_BIG="y",TUWidget.settings.big="checked"):(window.Tildaupload_BIG="",TUWidget.settings.big=""),TUWidget.htmlPopup='<div class="tu-popup" id="tu-popup"><div class="tu-popup-container"> <div class="tu-popup-bg"><input type="text" value="" id="tu-hidden-input-paste" style="position:absolute; opacity:0;width:1px; height:1px;"></div><div class="tu-popup-close"><div class="tu-popup-close-line tu-popup-close-line-first"></div><div class="tu-popup-close-line tu-popup-close-line-second"></div></div><div class="tu-popup-wrapper"><div class="tu-popup-closer"></div><div class="tu-popup-content" style="display: block;"><div class="tu-uploader-steps">\x3c!-- Muliple screen --\x3e<div class="tu-uploader-multiple"><div class="tu-uploader-multiple-header"><div class="tu-uploader-multiple-title"> </div><div class="tu-uploader-multiple-buttons"><div class="tu-uploader-multiple-btn tu-uploader-multiple-btn-gray tu-js-removeall">'+TUWidget.dicts[TUWidget.locale].removeAll+'</div><div class="tu-uploader-multiple-btn tu-uploader-multiple-btn-orange tu-js-selected">'+TUWidget.dicts[TUWidget.locale].uploadSelected+'</div></div></div><div class="tu-uploader-multiple-images"><div class="tu-uploader-multiple-img-item"><div class="tu-uploader-multiple-addmore-wrapper"><div class="tu-uploader-multiple-addmore-separator"></div><div class="tu-uploader-multiple-addmore-plus"><div class="tu-uploader-multiple-addmore-plus-line tu-uploader-multiple-addmore-plus-line-first"></div><div class="tu-uploader-multiple-addmore-plus-line tu-uploader-multiple-addmore-plus-line-second"></div></div></div></div></div></div>\x3c!-- uploader main screen --\x3e<div class="tu-uploader-wrapper">\x3c!-- settings --\x3e<div class="tu-uploader-settings"><div class="tu-uploader-settings__icon"><div class="tu-uploader-settings__hover"><div class="tu-uploader-settings__hover__icon"></div><div class="tu-uploader-settings__menu"><div class="tu-uploader-settings__group"><div class="tu-uploader-settings__switch"><label class="tu-uploader-settings__big"><input type="checkbox" name="big" value="y" '+TUWidget.settings.big+'><span class="slider round"></span><span class="switch-state">'+TUWidget.dicts[TUWidget.locale].settings.big+'</span></label></div><div class="tu-uploader-settings__group__descr">'+TUWidget.dicts[TUWidget.locale].settings.attentionToBig+'</div></div></div></div></div></div>\x3c!-- multiple --\x3e<div class="tu-uploader-multiple-nav"><div class="tu-uploader-multiple-nav-title">'+TUWidget.dicts[TUWidget.locale].defaultMessage+'</div><div class="tu-uploader-multiple-nav-btn">'+TUWidget.dicts[TUWidget.locale].browseFiles+'</div></div>\x3c!-- /end multiple --\x3e<div class="tu-uploader-area"></div><div class="tu-uploader-title tu-title-lg">'+TUWidget.dicts[TUWidget.locale].defaultMessage+'</div><div class="tu-uploader-button-wrapper"><div class="tu-uploader-button tu-clickable">'+ +TUWidget.dicts[TUWidget.locale].buttonUpload+'</div></div><div class="tu-uploader-link-wrapper"><div class="tu-uploader-link-img tu-uploader-link"><svg viewBox="0 0 14 14" height="14px" width="14px"><g fill-rule="evenodd" fill="none" stroke-width="1" stroke="none"><g fill="#CCCCCC" transform="translate(-311.000000, -503.000000)" sketch:type="MSLayerGroup"><g transform="translate(311.000000, 503.000000)"><path d="M9.63740351,6.15189474 C9.46621053,5.76726316 9.22624561,5.40522807 8.91063158,5.08961404 C8.59477193,4.77424561 8.23298246,4.53403509 7.84835088,4.36284211 L7.37185965,4.83933333 L7.04077193,5.17017544 L6.69715789,5.51378947 C6.63329825,5.57740351 6.57901754,5.64666667 6.53161404,5.71912281 C6.9877193,5.74884211 7.41459649,5.93280702 7.74077193,6.25922807 C8.0762807,6.59449123 8.25066667,7.0262807 8.27964912,7.46568421 C8.29610526,7.70982456 8.26589474,7.95445614 8.18754386,8.18901754 C8.10059649,8.44985965 7.96059649,8.6957193 7.75722807,8.90547368 C7.75084211,8.91161404 7.74715789,8.91922807 7.74126316,8.92536842 L7.35098246,9.31515789 L6.80964912,9.85649123 L6.30466667,10.3617193 L4.98842105,11.6779649 C4.6322807,12.0341053 4.15922807,12.2298596 3.65522807,12.2298596 C3.15221053,12.2298596 2.67817544,12.033614 2.32203509,11.6774737 C1.96638596,11.3218246 1.77038596,10.8482807 1.77038596,10.3447719 C1.77038596,9.84126316 1.96614035,9.36747368 2.3222807,9.01157895 L3.64049123,7.69312281 C3.56508772,7.45929825 3.51129825,7.22007018 3.47814035,6.97863158 C3.45357895,6.79859649 3.43687719,6.61757895 3.43614035,6.43607018 C3.43368421,6.10252632 3.47494737,5.76922807 3.55207018,5.44280702 L1.15242105,7.84221053 C-0.229157895,9.2242807 -0.229157895,11.4652632 1.15242105,12.8473333 C1.84357895,13.538 2.74915789,13.8838246 3.65473684,13.8838246 C4.56080702,13.8838246 5.46638596,13.5382456 6.15729825,12.8473333 L8.55326316,10.4513684 L8.91014035,10.0949825 C9.11424561,9.89063158 9.28470175,9.66564912 9.42838596,9.42936842 C9.65459649,9.05849123 9.80835088,8.65666667 9.88522807,8.24207018 C9.92477193,8.02887719 9.94589474,7.81298246 9.94589474,7.59659649 C9.94638596,7.3325614 9.91396491,7.06901754 9.85550877,6.81014035 C9.80540351,6.58540351 9.73270175,6.36508772 9.63740351,6.15189474 L9.63740351,6.15189474 Z" /><path d="M12.8473333,1.15291228 C12.1561754,0.462 11.2503509,0.116421053 10.3450175,0.116421053 C9.43894737,0.116666667 8.53336842,0.462 7.84245614,1.15315789 L5.44673684,3.54887719 L5.08985965,3.90575439 C4.88550877,4.11010526 4.71529825,4.33508772 4.57136842,4.57112281 C4.34540351,4.942 4.19140351,5.34382456 4.1142807,5.75842105 C4.07473684,5.97161404 4.05361404,6.18775439 4.05361404,6.40389474 C4.05336842,6.66792982 4.08554386,6.93147368 4.144,7.19059649 C4.19484211,7.41508772 4.26754386,7.63540351 4.36284211,7.84884211 C4.53403509,8.23322807 4.77375439,8.59501754 5.08961404,8.91063158 C5.40547368,9.22624561 5.76701754,9.46621053 6.15189474,9.63764912 L6.62814035,9.16140351 L6.95922807,8.8305614 L7.30259649,8.48719298 C7.36645614,8.42333333 7.42098246,8.35407018 7.46838596,8.28136842 C7.01203509,8.25164912 6.58515789,8.06792982 6.25873684,7.74126316 C5.92273684,7.40550877 5.74835088,6.97273684 5.71936842,6.53235088 C5.70364912,6.28894737 5.73435088,6.04554386 5.81221053,5.81147368 C5.89866667,5.55063158 6.03866667,5.30452632 6.24252632,5.09501754 C6.24866667,5.08887719 6.25259649,5.08150877 6.25873684,5.07512281 L6.64877193,4.68508772 L7.19035088,4.14375439 L7.69557895,3.63852632 L9.01157895,2.32277193 C9.3677193,1.96663158 9.84101754,1.77038596 10.3450175,1.77038596 C10.8485263,1.77038596 11.3220702,1.96663158 11.6777193,2.32252632 C12.4130877,3.05764912 12.4130877,4.25378947 11.6782105,4.98866667 L10.3595088,6.30712281 C10.4351579,6.54119298 10.4887018,6.78017544 10.5218596,7.02185965 C10.5466667,7.20189474 10.5631228,7.38291228 10.5638596,7.56417544 C10.5663158,7.89796491 10.5252982,8.23101754 10.4474386,8.5574386 L12.8473333,6.15803509 C14.2289123,4.77596491 14.2289123,2.53498246 12.8473333,1.15291228 L12.8473333,1.15291228 Z" /> </g> </g> </g></svg></div><div class="tu-uploader-link">'+TUWidget.dicts[TUWidget.locale].uploadToLink+'</div><div class="tu-uploader-paste" style="display:none;">'+TUWidget.dicts[TUWidget.locale].uploadToPaste+'</div></div></div>\x3c!-- uploader url screen --\x3e<div class="tu-uploaderurl-wrapper"><div class="tu-uploaderurl-title tu-title-lg">'+TUWidget.dicts[TUWidget.locale].fileFromTheWeb+'</div><div class="tu-uploadurl-descr tu-descr-sm">'+TUWidget.dicts[TUWidget.locale].attentionToLink+'</div><div class="tu-uploadurl-form"><div class="tu-uploadurl-blockinput"><input placeholder="'+TUWidget.dicts[TUWidget.locale].pasteLink+'" class="tu-uploadurl-input"></div><div class="tu-uploadurl-blockbtn"><button class="tu-uploadurl-btn">'+TUWidget.dicts[TUWidget.locale].buttonUploadLink+'</button></div></div><div class="tu-uploaderurl-link-wrapper"><div class="tu-uploaderurl-link-img"><svg viewBox="0 0 4 12" height="12px" width="4px"><g fill-rule="evenodd" fill="none" stroke-width="1" stroke="none"><g fill="#FC8665" transform="translate(2.000000, 6.000000) scale(1, -1) translate(-2.000000, -6.000000) "><path d="M1.8545625,0.1845 L0.09675,3.19035937 C0.0405,3.28879687 0.085359375,3.375 0.197859375,3.375 L1.40639063,3.375 L1.40639063,12 L2.53139063,12 L2.53139063,3.375 L3.71348438,3.375 C3.82598438,3.375 3.88054688,3.28879687 3.81023438,3.19035937 L2.05242188,0.1845 C2.03132813,0.13528125 1.9996875,0.109828125 1.96453125,0.109828125 C1.92923438,0.109828125 1.88971875,0.13528125 1.8545625,0.1845 Z" /></g></g></svg></div><div class="tu-uploaderurl-link">'+TUWidget.dicts[TUWidget.locale].backToLocalUpload+"</div></div></div></div></div></div></div></div>",TUWidget.showUploader=function(){$("#tu-popup").fadeIn(20),$(".tu-popup-content").fadeIn(0,function(){$(this).addClass("tu-popup-content-scale")})},TUWidget.hideUploader=function(e){var t=$("#tu-popup");if(0==t.length)return!1;t.fadeOut(40),$("body").removeClass("tu-opened"),t.find(".tu-popup-content").removeClass("tu-popup-content-scale"),window.tu_flag_widget_ui_focus=!1,tu=t.data("tildaupload"),$elem=t.data("tu-original-elem"),"undefined"!=typeof $elem&&(tu.element=$elem.get(0)),tu.options.uploadMultiple&&0===tu.getActiveFiles().length&&0<tu.files.length&&!0!==e&&(0<(e=$("#"+tu.elementid+"-previews")).length&&e.removeClass("tu-popup-progressbar-error").removeClass("tu-popup-progressbar-completed").removeClass("tu-popup-progressbar-uploaded").addClass("tu-popup-progressbar-start")),t.data("tildaupload",""),t.remove(),$(document).off("paste",TUWidget.popupPasteHandler)},TUWidget.sortFiles=function(){var i,s,e=$("#tu-popup");0<e.length&&((i=e.data("tildaupload")).files&&0<i.files.length&&(s=[],e.find(".tu-js-preview-item").each(function(){for(var e,t=0,t=0;t<i.files.length;t++)if((e=i.files[t])&&e.tuInfo&&$(this).data("tu-url")==e.tuInfo.cdnUrl){s.push(e);break}}),i.files.length==s.length?i.files=s:console.log("Error in sort files")))},TUWidget.getPopup=function(){var s=$("#tu-popup");return 0==s.length&&($("body").append(TUWidget.htmlPopup),(s=$("#tu-popup")).find(".tu-uploader-link").click(function(e){return s.find(".tu-popup-content").addClass("tu-linkupload-screen"),s.find(".tu-uploadurl-input").focus(),!1}),s.find(".tu-uploaderurl-link").click(function(e){return s.find(".tu-popup-content").removeClass("tu-linkupload-screen"),!1}),s.find(".tu-uploader-multiple-nav-btn").click(function(e){s.find(".tu-popup-content").addClass("tu-uploader-multiple-screen")}),s.find(".tu-uploader-multiple-addmore-wrapper").click(function(e){s.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen")}),"y"===window.Tildaupload_BIG&&s.find(".tu-uploader-settings__big input").prop("checked","checked"),s.find(".tu-uploader-settings__big input").on("change",function(e){$(this).prop("checked")?(window.Tildaupload_BIG="y",document.cookie="Tildaupload_BIG=y; max-age=43200"):(window.Tildaupload_BIG="",document.cookie="Tildaupload_BIG=; expires=Thu, 01 Jan 1970 00:00:00 GMT")}),s.find(".tu-uploader-paste").click(function(e){var t=s.data("tu-original-elem");t.attr("id");return(t.data("tildaupload")||s.data("tildaupload")).paste(e),!1}),s.find(".tu-js-selected").click(function(){var e=s.data("tu-original-elem"),t=e.attr("id"),i=(i=e.data("tildaupload"))||s.data("tildaupload");TUWidget.sortFiles();e=i.getActiveFiles();if(0<e.length)return TUWidget.hideUploader(!0),!1;0<i.files.length&&(0<(t=$("#"+t+"-previews")).length&&t.removeClass("tu-popup-progressbar-error")),s.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen"),i.onUserDone&&i.options.uploadMultiple&&(i.onUserDone.call(i,i.files),0==e.length&&i.removeAllFiles(!0)),TUWidget.hideUploader(!0)}),s.find(".tu-js-removeall").click(function(){var e=s.data("tu-original-elem");e.attr("id");(e.data("tildaupload")||s.data("tildaupload")).removeAllFiles(!0),s.find(".tu-uploader-multiple-nav-title").html(TUWidget.dicts[TUWidget.locale].defaultMessage),s.find(".tu-uploader-multiple-title").html(""),s.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen").removeClass("tu-uploader-has-miltiple-img")}),$(document).keydown(function(e){27==e.keyCode&&$("body").hasClass("tu-opened")&&TUWidget.hideUploader()}),s.find(".tu-popup-bg, .tu-popup-close, .tu-popup-closer").click(function(e){TUWidget.hideUploader()}),s.find(".tu-uploadurl-blockbtn").click(function(e){var t=s.data("tu-original-elem");t.attr("id");e.preventDefault();e=$(this).closest(".tu-uploadurl-form").find(".tu-uploadurl-input").val();return(t.data("tildaupload")||s.data("tildaupload")).uploadFileFromURL(e),!1}),s.find(".tu-uploader-multiple-images").sortable({helper:"clone",items:"div.tu-js-preview-item",opacity:.8,placeholder:"tu-uploader-multiple-img-item",revert:!0,scrollSensitivity:10,tolerance:"pointer"}),s.find(".tu-uploader-multiple-images").disableSelection()),s},TUWidget.popupPasteHandler=function(e){var t,i,s,o;$popup=$("#tu-popup"),0==$popup.find(".tu-linkupload-screen").length&&((t=e.originalEvent||e).clipboardData?(console.log("PASTED!="+t+", "+t.clipboardData),t.clipboardData.items&&0<t.clipboardData.items.length?$popup.data("tildaupload").paste(t):((i=t.clipboardData.getData("text/html"))&&0<i.toLowerCase().indexOf("<img")&&(i=(i=(i=i.toLowerCase().split("<img"))[1]).split("src="))[1]&&(i=(s=(i=i[1].substring(1)).indexOf("'"))<(o=i.indexOf('"'))&&0<s?i.substring(0,s):i.substring(0,o)),""==i&&"http"!=(i=t.clipboardData.getData("text/plain")).substring(0,4)&&(i=""),""<i&&($popup.find(".tu-uploader-link").click(),$popup.find(".tu-uploadurl-input").val(i),$popup.find(".tu-uploadurl-btn").click()))):window.clipboardData&&(window.clipboardData.items&&0<window.clipboardData.items.length?$popup.data("tildaupload").paste(window):(i=window.clipboardData.getData("Html"))&&0<i.toLowerCase().indexOf("<img")&&((i=(i=(i=i.toLowerCase().split("<img"))[1]).split("src="))[1]&&(i=(s=(i=i[1].substring(1)).indexOf("'"))<(o=i.indexOf('"'))&&0<s?i.substring(0,s):i.substring(0,o)),""==i&&"http"!=(i=window.clipboardData.getData("Text")).substring(0,4)&&(i=""),""<i&&($popup.find(".tu-uploader-link").click(),$popup.find(".tu-uploadurl-input").val(i),$popup.find(".tu-uploadurl-btn").click()))),TUWidget.focusHiddenArea(),e.preventDefault())},TUWidget.focusHiddenArea=function(){var e;0==$("#tu-popup").find(".tu-linkupload-screen").length&&((e=$("#tu-hidden-input-paste")).val(""),e.focus().select())},TUWidget.openPopup=function(e){var t=TUWidget.getPopup(),i=(e.attr("id"),e.data("tildaupload"));i.element=t.find(".tu-uploader-wrapper").get(0),$("body").addClass("tu-opened"),window.tu_flag_widget_ui_focus=!0,t.data("tu-original-elem",e),t.data("tildaupload",i),TUWidget.showUploader(),i.waitCompletedForSuccess=!1,i.enableAddDropZone(),0<i.files.length&&i.removeAllFiles(!0),$(document).on("paste",TUWidget.popupPasteHandler),i.options.uploadMultiple?t.find(".tu-uploader-button").html(TUWidget.dicts[TUWidget.locale].buttonUploads):t.find(".tu-uploader-button").html(TUWidget.dicts[TUWidget.locale].buttonUpload)},TUWidget.init=function(t){if(0==t.length){var e={done:function(){return this},fail:function(){return this},progress:function(){return this}};return e}var i,s,o=t.attr("id"),l=250;o||(o="tuwidget"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),t.attr("id",o));e="yes"==t.data("tu-multiple");return"IMG"==t.prop("tagName").toUpperCase()?(i=o,l=t.width(),s="yes"==t.data("tu-noclick")?"":o,previewsContainer=i):"INPUT"==t.prop("tagName").toUpperCase()?(i=o+"-previews",s=previewsContainer=(i=o)+"-previews","hidden"!=t.attr("type")&&t.hide()):(i=o,l=t.width(),s="yes"!=t.data("tu-noclick")?o:"",previewsContainer="",t.attr("data-tu-preview-container")&&"undefined"!=t.attr("data-tu-preview-container")&&(previewsContainer=t.attr("data-tu-preview-container"))),Tildaupload_UPLOADKEY=Tildaupload_UPLOADKEY||"",(i=new Tildaupload("#"+i,{url:TUWidget.urlUploadAPI+"?publickey="+Tildaupload_PUBLICKEY+"&uploadkey="+Tildaupload_UPLOADKEY,clickable:!1,thumbnailWidth:l,thumbnailHeight:null,addRemoveLinks:!1,originalelement:t.get(0),additionalDropzone:["#tu-popup .tu-uploader-wrapper","#tu-popup  .tu-uploader-multiple-addmore-wrapper"],previewsContainer:previewsContainer?"#"+previewsContainer:null,hiddenInputContainer:$("#"+i).parent().get(0),fileNameSize:22,uploadMultiple:e,maxFiles:e?50:1,parallelUploads:e?3:1,locale:TUWidget.locale,dicts:TUWidget.dicts,acceptedFiles:"no"==t.data("tu-is-image")?""<t.data("tu-accepted-files")&&t.data("tu-accepted-files"):"image/*"})).$originalelement=t,i.on("addedfile",function(e){var t,i,s=this.$originalelement,o=s.attr("id");this.options.uploadMultiple||(0<$("#tu-popup").length&&TUWidget.hideUploader(),"IMG"==s.prop("tagName")?(s.css({opacity:.5}),i=s.position(),t=s.offset(),0==$("#"+o+"-progress").length?s.hasClass("tn-atom__img")?s.after('<div id="'+o+'-progress" style="width: '+s.width()+'px; height: 3px; box-sizing: border-box; padding: 0; margin:0; position: absolute;background: #222222;"><div style="height: 100%; margin:0; padding:0; background: #FC8665; width: 0%; position: relative;" data-tu-uploadprogress></div></div>'):(offseth=parseInt(i.top+s.height()),s.after('<div id="'+o+'-progress" style="width: '+s.width()+"px; height: 3px; box-sizing: border-box; padding: 0; margin:0; position: absolute;background: #222222; top:"+offseth+"px; left: "+t.left+'px;"><div style="height: 100%; margin:0; padding:0; background: #FC8665; width: 0%; position: relative;" data-tu-uploadprogress></div></div>')):($("#"+o+"-progress").show(),Tildaupload.setPositionForProgressLine(s),$("#"+o+"-progress").css({background:"#222222"}),$("#"+o+"-progress > div").css({width:"0px"})),e.previewElement=null):"INPUT"==s.prop("tagName")||""<s.attr("bgimgfield")&&(0==$("#"+o+"-progress").length?(i=s.offset(),s.prepend('<div id="'+o+'-progress" style="width: '+s.width()+'px; height: 3px; box-sizing: border-box; padding: 0; margin:0; position: absolute;z-index:100;background: #000000; background: #222222;"><div style="height: 100%; margin:0; padding:0; background: #FC8665; width: 0%; position: relative;" data-tu-uploadprogress></div></div>')):(console.log("show progress line for bg"),$("#"+o+"-progress").show(),$("#"+o+"-progress").css({top:"0",left:"0",background:"#222222"}),$("#"+o+"-progress > div").css({width:"0px"})),e.previewElement=null))}),i.on("uploadprogress",function(e,t,i){var s=this.$originalelement,o=s.attr("id");this.onUserProgress&&!this.options.uploadMultiple?this.onUserProgress.call(this,t,e):0<$("#"+o+"-progress").length&&(Tildaupload.setPositionForProgressLine(s),t*=.8,$("#"+o+"-progress").find("div").css({width:t+"%"}),80==t&&Tildaupload.animate($("#"+o+"-progress").find("div").get(0),{width:{start:80,end:95,step:1}},"slow"))}),e&&(i.on("addedfiles",function(e){var t=this.$originalelement,i=t.attr("id"),s=$("#"+i+"-previews");0<s.length?(s.find("[data-tu-uploadprogress]").css({width:"0%"}),s.removeClass("tu-popup-progressbar-start"),s.removeClass("tu-popup-progressbar-completed"),s.removeClass("tu-popup-progressbar-uploaded"),s.addClass("tu-processing"),s.find("[data-tu-name]").html("Uploading "+e.length+" files"),$("#"+i+"-previews").find("[data-tu-size]").html(""+this.sizeUploadedFiles())):0<$("#"+i+"-progress").length&&(Tildaupload.setPositionForProgressLine(t),$("#"+i+"-progress").find("div").css({width:"0%"}))}),i.on("totaluploadprogress",function(e,t,i){var s=this.$originalelement,o=s.attr("id");this.options.uploadMultiple&&(this.onUserProgress?this.onUserProgress.call(this,e):(0<$("#"+o+"-progress").length?(s.position(),Tildaupload.setPositionForProgressLine(s),$("#"+o+"-progress").find("div").css({width:e+"%"})):this.originalelement&&"INPUT"==this.originalelement.nodeName&&0<$("#"+o+"-previews").length&&$("#"+o+"-previews").find("[data-tu-uploadprogress]").css({width:parseInt(e)+"%"}),this.options.uploadMultiple&&0<($popup=$("#tu-popup")).length&&(s=this.files.length,$popup.find(".tu-js-selected").css("display","inline-block"),$popup.find(".tu-js-removeall").hide(),0==s?($popup.find(".tu-uploader-multiple-nav-title").html("Drop file here"),$popup.find(".tu-uploader-multiple-title").html(""),$popup.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen").removeClass("tu-uploader-has-miltiple-img"),$popup.find(".tu-js-selected").hide(),$popup.find(".tu-js-removeall").hide()):("RU"==this.options.locale?(e=humanDigits(s,["файл","файла","файлов"]),$popup.find(".tu-uploader-multiple-title").html("Вы выбрали "+s+" "+e),$popup.find(".tu-uploader-multiple-nav-title").html("Вы выбрали "+s+" "+e)):(s+=1==s?" file":" files",$popup.find(".tu-uploader-multiple-title").html("You’ve selected "+s),$popup.find(".tu-uploader-multiple-nav-title").html("You’ve selected "+s)),$popup.find(".tu-js-selected").css("display","inline-block"),1<s&&$popup.find(".tu-js-removeall").css("display","inline-block"),0<$("#"+o+"-previews").length&&("RU"==this.options.locale?$("#"+o+"-previews").find("[data-tu-name]").html("Загружено файлов: "+this.files.length+", "):$("#"+o+"-previews").find("[data-tu-name]").html("Uploaded "+this.files.length+" files"),$("#"+o+"-previews").find("[data-tu-size]").html(""+this.sizeUploadedFiles()))))))}),i.on("successmultiple",function(e,t){var i,s,o=this.$originalelement,l=o.attr("id");if("string"==typeof t&&"{"==t.substring(0,1)&&(t=$.parseJSON(t)),t.result&&0<t.result.length)for(var r=0;r<t.result.length;r++)for(var n=0;n<this.files.length;n++)if(this.files[n].name==t.result[r].originalUrl||null==this.files[n].name&&"blob"==t.result[r].originalUrl){this.files[n].tuInfo=t.result[r];break}this.originalelement&&"IMG"==this.originalelement.nodeName?(o.css({opacity:1}),0<$("#"+l+"-progress").length&&setTimeout(function(){$("#"+l+"-progress").fadeOut(20)},500)):this.originalelement&&"INPUT"==this.originalelement.nodeName&&0<$("#"+l+"-previews").length&&((i=$("#"+l+"-previews")).addClass("tu-popup-progressbar-uploaded"),s=this.getActiveFiles().length,o=this.files.length-s,"RU"==this.options.locale?0<s?i.find("[data-tu-name]").html("Загружено файлов: "+o+" из "+this.files.length+", "):i.find("[data-tu-name]").html("Загружено файлов: "+o+", "):0<s?i.find("[data-tu-name]").html("Uploaded "+o+" from "+this.files.length+" files"):i.find("[data-tu-name]").html("Uploaded "+o+" files"),i.find("[data-tu-size]").html(""+this.sizeUploadedFiles()),window.setTimeout(function(){i.removeClass("tu-processing"),i.removeClass("tu-popup-progressbar-uploaded"),i.addClass("tu-popup-progressbar-completed"),i.find("[data-tu-uploadprogress]").css({width:"0%"})},500)),0==$("#tu-popup").length&&0==this.getActiveFiles().length&&this.onUserDone&&this.options.uploadMultiple&&this.onUserDone.call(this,this.files)}),i.on("errormultiple",function(e){var t,i=this.$originalelement.attr("id");this.originalelement&&"IMG"==this.originalelement.nodeName?0<$("#"+i+"-progress").length&&$("#"+i+"-progress").css({background:"#FF2222"}):this.originalelement&&"INPUT"==this.originalelement.nodeName&&0<$("#"+i+"-previews").length&&((t=$("#"+i+"-previews")).addClass("tu-popup-progressbar-error"),t.find("[data-tu-errormessage]").html("Error !")),console.log("_["+i+"] error multiple: "+e.length)}),i.on("completemultiple",function(e){this.$originalelement.attr("id");if(this.options.uploadMultiple&&e)for(var t=0;t<e.length;t++)file=e[t];0==$("#tu-popup").length&&0==this.getActiveFiles().length&&this.removeAllFiles(!0)})),i.on("thumbnail",function(e,t){var i=this.$originalelement,s=i.attr("id");this.options.uploadMultiple||("IMG"==i.prop("tagName")?i.attr("src",t):i.attr("bgimgfield")?(0<i.find(".t-cover__carrier").length?i.find(".t-cover__carrier"):i).css({"background-image":"url("+t+")"}):0==$("#"+s+"-thumb").length?$("#"+s+"-previews").length:"image/"==e.type.substring(0,6)&&$("#"+s+"-thumb").html('<img src="'+t+'" width="250">'))}),i.on("success",function(e,t){var i=this.$originalelement,s=i.attr("id"),o="",l="Upload error >";if(e.tuInfo||(e.tuInfo={}),"string"==typeof(serverText=t)&&console.log("_[#"+s+"] success event error: "+t),t&&"string"==typeof t&&"{"==t.substring(0,1)&&(t=$.parseJSON(t)),t&&t.result&&0<t.result.length)this.options.uploadMultiple||(e.tuInfo=t.result[0],"IMG"==i.prop("tagName")?(i.attr("src",t.result[0].cdnUrl).css({opacity:1}),i.data("tu-value",t.result[0].cdnUrl)):i.attr("bgimgfield")?((0<i.find(".t-cover__carrier").length?i.find(".t-cover__carrier"):i).css({"background-image":"url("+t.result[0].cdnUrl+")"}),i.data("tu-value",t.result[0].cdnUrl)):(o="",i.val(t.result[0].cdnUrl),""<t.result[0].cdnUrl?0==$("#"+s+"-thumb").length||("image/"==e.type.substring(0,6)?$("#"+s+"-thumb").html('<img src="'+t.result[0].cdnUrl+'" width="250">'):$("#"+s+"-thumb").html(t.result[0].cdnUrl)):o=t.result[0].error&&""<t.result[0].error?t.result[0].error+"<br>":"Upload error. Reload page and try again",r=$("#"+s+"-previews"),""<o?(0<r.length?(l=25<o.length?o.substring(0,23)+"...":o,r.find(".tu-popup-progressbar-error-title").html(l),r.removeClass("tu-popup-progressbar-completed"),r.removeClass("tu-popup-progressbar-success"),r.removeClass("tu-popup-progressbar-start"),r.addClass("tu-popup-progressbar-error"),r.find(".tu-popup-progressbar-error-text").html(o),window.setTimeout(function(){r.removeClass("tu-popup-progressbar-error"),r.addClass("tu-popup-progressbar-start")},5e3)):0<$("#"+s+"-progress").length&&(Tildaupload.setPositionForProgressLine(i),$("#"+s+"-progress").css({background:"#FF2222"})),null!=(n=i.data("tildaupload"))&&void 0!==n&&n.onUserFail&&!n.options.uploadMultiple&&n.onUserFail.call(n,e,t)):(r.addClass("tu-popup-progressbar-uploaded"),window.setTimeout(function(){r.removeClass("tu-processing"),r.removeClass("tu-popup-progressbar-uploaded"),r.addClass("tu-popup-progressbar-completed"),r.find("[data-tu-uploadprogress]").css({width:"0%"})},500))));else{console.log("event success ["+s+"]: error: "+serverText);var r,n=i.data("tildaupload");if(0<(r=$("#"+s+"-previews")).length){r.removeClass("tu-popup-progressbar-completed"),r.removeClass("tu-popup-progressbar-success"),r.removeClass("tu-popup-progressbar-start"),r.addClass("tu-popup-progressbar-error");var a,p="",l="Upload error >";if(t&&t.result&&t.result[0])for(a in t.result)t.result[a].error&&""<t.result[a].error&&(p+=t.result[a].error+"<br>");else t&&""<t.error&&(p=t.error+"<br>");""==p&&(p="Upload only image files"),l=25<p.length?p.substring(0,23)+"...":p,r.find(".tu-popup-progressbar-error-title").html(l),r.find(".tu-popup-progressbar-error-text").html(p),window.setTimeout(function(){r.removeClass("tu-popup-progressbar-error"),r.addClass("tu-popup-progressbar-start")},5e3)}else 0<$("#"+s+"-progress").length&&(Tildaupload.setPositionForProgressLine(i),$("#"+s+"-progress").css({background:"#FF2222"}));null!=n&&void 0!==n&&n.onUserFail&&!n.options.uploadMultiple&&n.onUserFail.call(n,e,t)}this.onUserDone&&!this.options.uploadMultiple&&this.onUserDone.call(this,e)}),i.on("complete",function(e){var t=this.$originalelement,i=t.attr("id");$("[data-tu-ondrag-hide=yes]").each(function(){"none"==$(this).css("display")&&$(this).data("tu-old-display")&&$(this).css({display:$(this).data("tu-old-display")})}),this.options.uploadMultiple||(e.previewElement=Tildaupload.createElement("<div></div>"),"IMG"==t.prop("tagName")?(t.css({opacity:1}),0<$("#"+i+"-progress").length&&setTimeout(function(){$("#"+i+"-progress").fadeOut(20).remove()},500)):0<$("#"+i+"-progress").length?setTimeout(function(){$("#"+i+"-progress").fadeOut(20).remove()},500):0<$("#"+i+"-previews").length&&0<$("#"+i+"-previews").find("[data-tu-size]").length&&$("#"+i+"-previews").find("[data-tu-size]").html(this.filesize(e.size)))}),i.on("queuecomplete",function(){this.$originalelement.attr("id");this.options.uploadMultiple||this.removeAllFiles()}),t.data("tildaupload",i),s&&$("#"+s).click(function(e){return e.preventDefault(),TUWidget.openPopup(t),!1}),i},$("[data-tu-ondrag-hide=yes]").on("dragstart dragenter dragover",function(){"none"!=$(this).css("display")&&($(this).data("tu-old-display",$(this).css("display")),$(this).css({display:"none"}))})});
