function tp__addRecord(o,i){edrec__closeEditForm(),$("#myfirstrecord")&&$("#myfirstrecord").css({display:"none"}),tp__ajax("/page/submit/",{comm:"addnewrecord",pageid:window.pageid,afterid:i,tplid:o},{ctext:"adding new block"},function(t){var e;tp__checkEmptyOrNotHtmlResponce(t)||(e=$(t).attr("id"),0<i?($("#record"+i).after(t),$("html, body").animate({scrollTop:$("#record"+i).offset().top+$("#record"+i).height()-100},700)):($("#allrecords").append(t),$("html, body").animate({scrollTop:$("#"+e).offset().top-100},700)),$("#"+e).css("opacity","0"),$("#"+e).animate({opacity:"1"},700,"easeInCirc"),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList(),"125"!=o&&"132"!=o&&"284"!=o&&"132"!=o||location.reload())},function(){setTimeout(function(){location.reload()},3e3)})}function tp__checkEmptyOrNotHtmlResponce(t){return""==t?(td__showBubbleNotice("Error. Request response is empty. Please reload the page and try again.",6e3,"error"),!0):-1===t.indexOf('class="record"')&&(td__showBubbleNotice(t,6e3,"error"),!0)}function tp__dublicateRecord(e){$("#record"+e).find(".tp-record-edit-icons-right__wrapper").css("pointer-events","none").css("opacity","0.5"),tp__ajax("/page/submit/",{comm:"dublicaterecord",pageid:window.pageid,recordid:e},{ctext:"block duplicating"},function(t){tp__checkEmptyOrNotHtmlResponce(t)||($("#record"+e).after(t),$("html, body").animate({scrollTop:$("#record"+e).offset().top+$("#record"+e).height()-100},700),t=$(t).attr("id"),$("#"+t).css("opacity","0"),$("#"+t).animate({opacity:"1"},700,"easeInCirc"),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList())},function(){setTimeout(function(){location.reload()},3e3)},function(){$("#record"+e).find(".tp-record-edit-icons-right__wrapper").css("pointer-events","auto").css("opacity","1")})}function tp__delRecord(i){showLoadIcon(),$("#record"+i).find(".tp-record-edit-icons-right__wrapper").css("pointer-events","none").css("opacity","0.5"),tp__ajax("/page/submit/",{comm:"deleterecord",pageid:window.pageid,recordid:i},{ctext:"block deletion"},function(t){var e,o;""==t||"ok"==t?(e=$("#record"+i),(o=document.body.querySelector("#record"+i+" video"))&&window.videoLoadProcessor.unergisterVideo(o),e.slideUp("fast",function(){e.remove()}),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList()):td__showBubbleNotice(t,6e3,"error")},function(){setTimeout(function(){location.reload()},3e3)},function(){$("#record"+i).find(".tp-record-edit-icons-right__wrapper").css("pointer-events","auto").css("opacity","1")})}function tp__recoverRecord(e){tp__ajax("/page/submit/",{comm:"recoverrecord",pageid:window.pageid,recordid:e},{ctext:"block recover"},function(t){""==t||"ok"==t?(tp__updateUndoButton(),tp__updateRecord(e)):td__showBubbleNotice(t,6e3,"error")},function(){setTimeout(function(){location.reload()},3e3)})}function tp__updateRecord(e){showLoadIcon(),tp__ajax("/page/get/",{comm:"getrecordhtml",pageid:window.pageid,recordid:e},{ctext:"update block"},function(t){tp__checkEmptyOrNotHtmlResponce(t)||($("#record"+e).replaceWith(t),void 0!==window.blockList&&window.blockList.rebuildList())},function(){setTimeout(function(){location.reload()},3e3)})}function tp__updateRecord_fixed(e){showLoadIcon(),$.ajax({type:"POST",url:"/page/get/",data:{comm:"getrecordhtml",pageid:window.pageid,recordid:e},dataType:"text",success:function(t){check_logout(t),hideLoadIcon(),$("#record"+e).replaceWith(t),void 0!==window.blockList&&window.blockList.rebuildList()},error:function(t){alert("Request timeout (updating block)"),hideLoadIcon(),location.reload()},timeout:3e4})}function tp__upRecord(t){var e,o=$("#record"+t);o.prev().attr("recordid")&&(e=o.clone(),o.prev().before(e),o.remove(),tp__scrollTo(t),tp__record__addEditFieldEvents(t),tp__record__addEditOnReady(t),tp__record__onBordersdragmode(t),clearTimeout(autosavesort_timer),autosavesort_timer=setTimeout(function(){tp__saveRecordsSort()},4e3))}function tp__downRecord(t){var e,o=$("#record"+t);o.next().attr("recordid")&&(e=o.clone(),o.next().after(e),o.remove(),tp__scrollTo(t),tp__record__addEditFieldEvents(t),tp__record__addEditOnReady(t),tp__record__onBordersdragmode(t),clearTimeout(autosavesort_timer),autosavesort_timer=setTimeout(function(){tp__saveRecordsSort()},4e3))}function tp__offRecord(e){$("#record"+e).find(".tp-record-edit-icons-right__wrapper").css("pointer-events","none").css("opacity","0.5"),tp__ajax("/page/submit/",{comm:"offrecord",pageid:window.pageid,recordid:e},{ctext:"block off/on"},function(t){""==t||"y"==t||"n"==t||"on"==t||"off"==t?("y"==t||"off"==t?tp__minifyRecord(e):($("#record"+e).find(".r").html(""),$("#record"+e).find(".r").css("min-height","65px"),$("#record"+e).attr("off","n"),tp__updateRecord_fixed(e)),tp__updateUndoButton()):td__showBubbleNotice(t,6e3,"error")},function(){},function(){$("#record"+e).find(".tp-record-edit-icons-right__wrapper").css("pointer-events","auto").css("opacity","1")})}function tp__minifyRecord(t){var e=$("#record"+t),o=e.find(".tp-record-edit-icons-left__item-tplcod").html(),t=e.find(".tp-record-edit-icons-left__item-tpltitle").html();void 0===o&&(o=""),void 0===t&&(t=""),e.find(".r").html("<div style='width:100%; height:65px; display:table; background-color:#eee;'><div style='display:table-cell; width:100%; vertical-align:middle; text-align:center; opacity:0.7; cursor:default;'><b>"+o+". "+t+"</b>. <img src='https://static.tildacdn.com/lib/linea/0a73dde9-ce52-6771-0281-ee9e47000721/basic_eye_closed.svg' style='padding:10px 10px; width:30px;'> "+("RU"===window.lang?"Блок спрятан. Нажмите кнопку «Спрятать/Показать» справа, чтобы сделать его видимым.":"This block is hidden. Press on 'Hide/Show' button on the right side to activate it.")+"</div>"),e.find(".r + div").remove(),e.find(".r").css("padding",""),e.find("#mainleft").css("display","none"),e.find(".tp-record-edit-icons-left__item-tpltitle").css("display","none"),e.attr("off","y")}function tp__changeRecordTpl(o,t){var e=tp__record__getFlag_keepcontentifchangerecordtpl();tp__ajax("/page/submit/",{comm:"changerecordtpl",pageid:window.pageid,recordid:o,tplid:t,flag_keepcontentifchangerecordtpl:e},{ctext:"changing block template"},function(t){var e=$("#record"+o);t.indexOf('class="record"')?e.replaceWith(t):e.html(t),0==$("#record"+o).height()&&$("#record"+o).height("120"),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList()},function(){})}function tp__addFishRecord(o,t,i){edrec__closeEditForm(),$("#myfirstrecord")&&$("#myfirstrecord").css({display:"none"}),tp__ajax("/page/submit/",{comm:"addfishrecord",pageid:window.pageid,afterid:i,fishid:t},{ctext:"adding new block on page"},function(t){var e;tp__checkEmptyOrNotHtmlResponce(t)||(e=$(t).attr("id"),0<i?($("#record"+i).after(t),$("html, body").animate({scrollTop:$("#record"+i).offset().top+$("#record"+i).height()-100},700)):($("#allrecords").append(t),$("html, body").animate({scrollTop:$("#"+e).offset().top-100},700)),$("#"+e).css("opacity","0"),$("#"+e).animate({opacity:"1"},700,"easeInCirc"),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList(),"125"!=o&&"132"!=o&&"284"!=o&&"132"!=o||location.reload())},function(){setTimeout(function(){location.reload()},3e3)})}function tp__record__addEditUi(t,i){"object"!=typeof $tpls&&(console.log("ERROR! $tpls is not set"),$tpls=[]);var r=[];$tpls.forEach(function(t,e,o){t.id==i&&(r=t)});var e=300,o=$("#record"+t),d="",d='<div class="recordbordertop"></div>';o.prepend(d),d='<div class="recordborderbottom"></div>',d+='<div class="insertafterrecorbutton"><center><a href="javascript:tp__library__open(\''+t+'\');"><img src="/tpl/img/page/tp-08-add.svg"></a></center></div>',o.append(d),void 0===r.id&&(r.id=i,void 0!==o.attr("data-record-category")&&(r.type=o.attr("data-record-category")),void 0!==o.attr("data-record-cod")&&(r.cod=o.attr("data-record-cod")),r.editnotpublish="",r.title=""),d='<div class="recordediticons mainleft" id="mainleft">',d+='<div class="tp-record-edit-icons-left__wrapper">',"396"!==i&&"421"!==i&&"121"!==i&&void 0!==r.type&&""!==r.type&&void 0!==r.cod&&""!==r.cod&&(d+='<div class="tp-record-edit-icons-left__one">',d+='<div class="tp-record-edit-icons-left__item">',d+='<div class="tp-record-edit-icons-left__dropdown-toggle" onclick="javascript:tp__record__showLefdropdown(\''+t+"');\">",void 0!==r.cod&&""!==r.cod&&(d+='<div class="tp-record-edit-icons-left__item-tplcod">'+r.cod+"</div>"),d+='<div class="tp-record-edit-icons-left__item-dropicon"><span class="caret"></span></div>',d+="</div>",d+='<div class="tp-record-edit-icons-left__dropdown-menu">',d+="</div>",d+="</div>",d+="</div>"),d+='<div class="tp-record-edit-icons-left__one-right-space">',d+="</div>",d+='<div class="tp-record-edit-icons-left__two">',d+='<div class="tp-record-edit-icons-left__item" onclick="edrec__editRecordSettings(\''+t+"');\">",d+='<div class="tp-record-edit-icons-left__item-icon"><span class="glyphicon glyphicon-cog"></span></div>',d+='<div class="tp-record-edit-icons-left__item-title"><span class="recordedit_mainleft_but_settings_title">'+("RU"==lang?"Настройки":"Settings")+"</span></div>",d+="</div>",d+="</div>",d+='<div class="tp-record-edit-icons-left__three">',"396"!==i&&"421"!==i?(d+='<div class="tp-record-edit-icons-left__item" onclick="edrec__editRecordContent(\''+t+"');\">",d+='<div class="tp-record-edit-icons-left__item-icon"><img src="/tpl/img/page/tp-03-edit.svg"></div>',d+='<div class="tp-record-edit-icons-left__item-title"><span class="recordedit_mainleft_but_settings_title">'+("RU"==lang?"Контент":"Content")+"</span></div>"):(d+='<div class="tp-record-edit-icons-left__item" onclick="tp__openZero(\''+t+"');\">",d+='<div class="tp-record-edit-icons-left__item-icon"><img src="/tpl/img/page/tp-03-edit.svg"></div>',d+='<div class="tp-record-edit-icons-left__item-title"><span class="recordedit_mainleft_but_settings_title">'+("RU"==lang?"Редактировать блок":"Block Editor")+"</span></div>"),d+="</div>",d+="</div>","754"!==i&&"776"!==i&&"778"!==i&&"786"!==i&&"951"!==i&&973!=i||0<$("#rec"+t).find(".t-store").length&&0<$("#rec"+t).find(".t-store").attr("data-storepart")&&(e=400,$("#rec"+t).find(".t-store").attr("data-storepart"),d+='<div class="tp-record-edit-icons-left__four">',d+="<a href='https://tilda.cc/identity/gostore/?projectid="+window.projectid+"' target='_blank'>",d+='<div class="tp-record-edit-icons-left__item">',d+='<div class="tp-record-edit-icons-left__item-icon"><img src="/tpl/img/page/tp-16-products.svg" width="14px" style="width:14px;"></div>',d+='<div class="tp-record-edit-icons-left__item-title"><span class="recordedit_mainleft_but_settings_title">'+("RU"==lang?"Товары":"Products")+"</span></div>",d+="</div>",d+="</a>",d+="</div>"),"896"!==i&&"897"!==i&&"915"!==i&&"924"!==i&&"925"!==i||0<$("#rec"+t).find(".t-feed").length&&(""==$("#rec"+t).find(".t-feed").attr("data-feedpart")||"5d9725a245f86259476957"!=(a=$("#rec"+t).find(".t-feed").attr("data-feedpart"))&&"5d971e17b674f464032195"!=a&&(e=385,d+='<div class="tp-record-edit-icons-left__four">',d+="<a href='https://tilda.cc/identity/gofeeds/?projectid="+window.projectid+"&feeduid="+a+"' target='_blank'>",d+='<div class="tp-record-edit-icons-left__item">',d+='<div class="tp-record-edit-icons-left__item-icon"><img src="/tpl/img/page/tp-17-news.svg" width="12px" style="width:12px;"></div>',d+='<div class="tp-record-edit-icons-left__item-title"><span class="recordedit_mainleft_but_settings_title">'+("RU"==lang?"Посты":"Posts")+"</span></div>",d+="</div>",d+="</a>",d+="</div>")),void 0!==r.editnotpublish&&"y"==r.editnotpublish&&(d+='<div class="tp-record-edit-icons-left__four">',d+='<div class="tp-record-edit-icons-left__item" onclick="showCornerNotice(\''+("RU"==lang?"Примечание: Вид данного блока и его поведение в режиме редактирования может отличаться от вида в режиме предпросмотра или публикации.":"Appearance of this block in the editing mode might be different from its appearance on preview and on published page.")+"',8000);\">",d+='<div class="tp-record-edit-icons-left__item-icon"><span class="fa fa-comment" style="color:#ffcf5d;"></span></div>',d+="</div>",d+="</div>"),d+=" </div>",d+="</div>",void 0===r.title&&void 0===r.title_ru||(d+='<div class="recordediticons secondleft tp-record-edit-icons-left__item-tpltitle">'+("RU"==lang&&void 0!==r.title_ru&&""!=r.title_ru?r.title_ru:void 0!==r.title&&""!=r.title?r.title:"")+"</div>"),o.prepend(d),d='<div class="recordediticons mainright" id="rightbuttons">',d+='<div class="tp-record-edit-icons-right__wrapper">',d+='<div class="tp-record-edit-icons-right__one">',d+='<div class="tp-record-edit-icons-right__items">',d+='<div class="tp-record-edit-icons-right__item-icon tp-record-edit-icons-right__item-icon_right-border" onclick="tp__dublicateRecord(\''+t+'\');" data-toggle="tooltip" data-placement="top" title="'+("RU"==lang?"Дублировать":"Duplicate")+'" ><img src="/tpl/img/page/tp-04-duplicate.svg"></div>',d+='<div class="tp-record-edit-icons-right__item-icon tp-record-edit-icons-right__item-icon_right-border" onclick="tp__delRecord(\''+t+'\');" data-toggle="tooltip" data-placement="top" title="'+("RU"==lang?"Удалить":"Delete")+'"><img src="/tpl/img/page/tp-05-delete-3.svg"></div>',d+='<div class="tp-record-edit-icons-right__item-icon tp-record-edit-icons-right__item-icon_right-border " onclick="tp__offRecord(\''+t+'\');" data-toggle="tooltip" data-placement="top" title="'+("RU"==lang?"Спрятать/Показать":"Hide/Show")+'"><img src="/tpl/img/page/tp-05-off.svg"></div>',d+='<div type="button" class="tp-record-edit-icons-right__item-icon dropdown-toggle" style="padding-top:2px; padding-right:3px;width:24px;" data-toggle=""><span class="caret"></span></div>',d+='<ul class="dropdown-menu">',d+="<li><a href=\"javascript:tp__record__bufCut('"+t+'\');" style="padding-left:0px;color:#000;">'+("RU"==lang?"Вырезать":"Cut")+"</a></li>",d+="<li><a href=\"javascript:tp__record__bufCopy('"+t+'\');" style="padding-left:0px;color:#000;">'+("RU"==lang?"Копировать":"Copy")+"</a></li>",d+="<li><a href=\"javascript:tp__record__bufPaste('"+t+'\');" style="padding-left:0px;color:#000;">'+("RU"==lang?"Вставить":"Paste")+"</a></li>",d+="<li><a href=\"javascript:tp__selectModeOn('"+t+'\');" style="padding-left:0px;color:#000;">'+("RU"==lang?"Выделить":"Select")+"</a></li>",d+="</ul>",d+="</div>",d+="</div>",d+='<div class="tp-record-edit-icons-right__one-right-space">',d+="</div>",d+='<div class="tp-record-edit-icons-right__two">',d+='<div class="tp-record-edit-icons-right__items">',d+='<div class="tp-record-edit-icons-right__item-icon btn-sort-recup" style="display:table-cell !important; border-right:1px #ccc solid;" onclick="tp__upRecord(\''+t+'\');" data-toggle="tooltip" data-placement="top" title="'+("RU"==lang?"Переместить вверх":"Move up")+'"><span class="glyphicon glyphicon-arrow-up"></span></div>',d+='<div class="tp-record-edit-icons-right__item-icon btn-sort-recdown" style="display:table-cell !important;"  onclick="tp__downRecord(\''+t+'\');" data-toggle="tooltip" data-placement="top" title="'+("RU"==lang?"Переместить вниз":"Move down")+'"><span class="glyphicon glyphicon-arrow-down"></span></div>',d+="</div>",d+="</div>",d+="</div>",d+="</div>",o.prepend(d),"4"!==i&&"124"!==i&&"251"!==i&&"378"!==i&&"259"!==i&&"368"!==i||t_video_lazyload_add_video();var n,a,c=o.find(".r");void 0===c.attr("data-screenmin")&&void 0===c.attr("data-screenmax")||(a=n="",void 0!==c.attr("data-screenmin")&&""!=c.attr("data-screenmin")&&(n=c.attr("data-screenmin")),void 0!==c.attr("data-screenmax")&&""!=c.attr("data-screenmax")&&(a=c.attr("data-screenmax")),d="",d+='<img src="https://static.tildacdn.com/lib/linea/bd5071b9-9e2d-2fa7-4562-c8c427f961ba/basic_eye.svg" style="width:18px; padding-right:8px;">',"RU"==lang?d+="от ":d+=" ",d+=""==n?"0px":n,"RU"==lang?d+=" до ":d+=" - ",d+=""==a?"&infin;":a,o.prepend('<div class="recordediticons" style="z-index:1000;left:'+e+'px;background:yellow;padding:6px 15px;cursor:default;" title="'+("RU"==lang?"Установлено ограничение на отображение на различных размерах экрана. Блок будет отображаться на экранах заданной ширины.":"There's a display restriction applied to this block. This block will appear only on screens with the specified width.")+'">'+d+"</div>")),"0px"==c.css("padding-top")&&o.find(".recordbordertop").css("height","10px"),"0px"==c.css("padding-bottom")&&o.find(".recordborderbottom").css("height","10px").css("margin-top","-10px"),"y"==o.attr("off")&&tp__minifyRecord(t),void 0!==o.attr("data-record-trash")&&"y"==o.attr("data-record-trash")&&(o.prepend('<div class="recordediticons" style="display:block;z-index:1001;left:20px;background:yellow;padding:6px 15px;cursor:pointer;font-weight:500;" title="" onclick="tp__recoverRecord(\''+t+"');\">"+("RU"==lang?"Восстановить из корзины":"Recover from Trash")+"</div>"),o.find(".mainright").remove(),o.find(".mainleft").remove()),tp__record__onBordersdragmode(t),o.height()<1&&o.css("min-height","100px")}function tp__record__addEditFieldEvents(i){var t=$("#record"+i);0!=t.length&&"121"!=t.attr("data-record-type")&&(t.find("[field]").click(tp__record__editField),t.find("[imgfield]").hover(function(){$(this).css("opacity",.7)},function(){$(this).css("opacity",1)}),$("#record"+i+" [imgfield], #record"+i+" [bgimgfield]").each(function(){var t=$(this),e=t.attr("id"),o="";void 0!==t.attr("imgfield")&&(o=t.attr("imgfield")),void 0!==t.attr("bgimgfield")&&(o=t.attr("bgimgfield")),e||(e="tuwidget"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),t.attr("id",e)),TUWidget.init(t).done(function(t){var e=$("#"+this.elementid);e.attr("bgimgfield"),e.trigger("tuwidget_done",t),showLoadIcon();e={comm:"saverecord"};e.pageid=window.pageid,e.recordid=i,e.onlythisfield=o,e[o+"-uploadmethod"]="tu",e[o+"-tuinfo-uuid"]=t.tuInfo.uuid,e[o+"-tuinfo-cdnurl"]=t.tuInfo.cdnUrl,e[o+"-tuinfo-name"]=t.tuInfo.name,e[o+"-tuinfo-width"]=t.tuInfo.width,e[o+"-tuinfo-size"]=t.tuInfo.size,$.ajax({type:"POST",url:"/page/submit/",data:e,dataType:"text",success:function(t){hideLoadIcon(),check_logout(t),$("html, body").animate({scrollTop:$("#record"+i).offset().top-50+Math.floor(100*Math.random()+1)},700),tp__updateRecord(i),t&&alert(t)},error:function(){hideLoadIcon(),alert("Request timeout (saving image)")},timeout:9e4})})}))}function tp__record__showUpDownIcons(t){t=$("#record"+t);"y"==t.find(".btn-sort-recup").attr("data-vis")?(t.find(".btn-sort-recup").removeAttr("style").removeAttr("data-vis"),t.find(".btn-sort-recdown").removeAttr("style").removeAttr("data-vis")):(t.find(".btn-sort-recup").attr("style","display: table-cell !important;").attr("data-vis","y"),t.find(".btn-sort-recdown").attr("style","display: table-cell !important;").attr("data-vis","y"))}function tp__record__addEditUiDel(t){var e;$("#record"+t).prepend('<div class="recordbordertop"></div>'),$("#record"+t).append('<div class="recordborderbottom"></div>'),e='<div class="recordediticons mainright" id="rightbuttons">',e+='<div class="tp-record-edit-icons-right__wrapper">',e+='<div class="tp-record-edit-icons-right__one">',e+='<div class="tp-record-edit-icons-right__items">',e+='<div class="tp-record-edit-icons-right__item-icon tp-record-edit-icons-right__item-icon_right-border" onclick="tp__delRecord(\''+t+'\');" data-toggle="tooltip" data-placement="top" title="Delete"><img src="/tpl/img/page/tp-05-delete-3.svg"></div>',e+="</div>",e+="</div>",e+="</div>",e+="</div>",$("#record"+t).prepend(e),"y"==$("#record"+t).attr("off")&&$("#record"+t).css("opacity","0.4"),$("#record"+t).height()<1&&$("#record"+t).css("min-height","100px")}function tp__record__addEditOnReady(t){$("#record"+t).find(".tp-tplswitch-item").click(function(){window.clearInterval(window.stickloop),$(".tp-tplswitch-item__icon").remove()})}function tp__record__stick_div_to_mouse(t){var e,o,i;void 0===o&&(e=0,o=350,i=100),$(document).mousemove(function(t){t.pageX,e=t.pageY}),window.stickloop=setInterval(function(){i+=(e-40-i)/12,$(t).css({left:o+"px",top:i+"px"})},30)}function tp__record__onBordersdragmode(t){var o="",i="",r="",d="",r="";$(".recordbordertop").draggable({axis:"y",grid:[15,15],revert:!0,start:function(t,e){d=parseInt($(this).parent().find(".r").css("padding-top")),r=$(this).offset().top,$(this).before('<div class="recordbordertop" id="bordercloned"></div>'),tp__record__drawBorderdraghelper($(this).parent(),"")},drag:function(t,e){o=$(this).offset().top-r,(i=d+o)<0&&(i=0),$(this).parent().find(".r").css("padding-top",i+"px"),$(this).css("display","block"),$(this).css("opacity","0.1"),$("#borderhelper_l").html((i/30).toFixed(1)),$("#borderhelper_r").html(i+"px")},stop:function(){$(this).css("opacity","1"),r=i=o="",showLoadIcon(),tp__record__removeBorderdraghelper();var t=15*Math.round(parseFloat($(this).parent().find(".r").css("padding-top"))/15);210<t&&(t=210),t+="px";var e=$(this).parent().attr("recordid");$(this).parent().find("#bordercloned").remove(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"saverecord",pageid:window.pageid,recordid:e,margintop:t,onlythisfield:"margintop"},dataType:"text",success:function(t){hideLoadIcon(),check_logout(t),tp__updateRecord(e),tp__updateUndoButton()},error:function(){hideLoadIcon()},timeout:3e4})}}),$(".recordborderbottom").draggable({axis:"y",grid:[15,15],start:function(){d=Math.round(parseFloat($(this).parent().find(".r").css("padding-bottom"))),r=Math.round(parseFloat($(this).offset().top)),tp__record__drawBorderdraghelper($(this).parent(),"bottom")},drag:function(){o=$(this).offset().top-r,(i=d+o)<0&&(i=0),$(this).parent().find(".r").css("padding-bottom",i+"px"),$(this).css("display","block"),$("#borderhelper_l").html((i/30).toFixed(1)),$("#borderhelper_r").html("("+i+"px)")},stop:function(){r=i=o="",showLoadIcon(),tp__record__removeBorderdraghelper();var t=15*Math.round(parseFloat($(this).parent().find(".r").css("padding-bottom"))/15);210<t&&(t=210),t+="px";var e=$(this).parent().attr("recordid");$.ajax({type:"POST",url:"/page/submit/",data:{comm:"saverecord",pageid:window.pageid,recordid:e,marginbottom:t,onlythisfield:"marginbottom"},dataType:"text",success:function(t){hideLoadIcon(),check_logout(t),tp__updateRecord(e),tp__updateUndoButton()},error:function(){hideLoadIcon()},timeout:3e4})}})}function tp__record__drawBorderdraghelper(t,e){var o="";o+='<div id="borderhelper" style="background-color:#000;color:#fff;pointer-events:none;padding:9px 10px;position:absolute;left:calc(50% - 50px); border-radius:20px; '+("bottom"==e?"bottom:20px;":"top:15px;")+' width:80px; text-align:center;opacity:0;font-size:13px;">&nbsp;<span id="borderhelper_l" style=""></span>&nbsp;&nbsp;&nbsp;<span id="borderhelper_r" style="opacity:0.4;"></span></div>',t.append(o),$("#borderhelper").animate({opacity:.9},200)}function tp__record__removeBorderdraghelper(){$("#borderhelper").animate({opacity:0},300),setTimeout(function(){$("#borderhelper").remove()},300)}function tp__record__showLefdropdown(t){var e=$("#record"+t),o=e.find(".tp-record-edit-icons-left__dropdown-menu"),i=e.attr("data-record-type");if(0===o.find(".tp-record-edit-icons-left__dropdown-menu-ul").length){"object"!=typeof $tpls&&(console.log("ERROR! $tpls is not set"),$tpls=[]);var r=[];$tpls.forEach(function(t,e,o){t.id==i&&(r=t)}),void 0===r.id&&(r.id=i,void 0!==e.attr("data-record-category")&&(r.type=e.attr("data-record-category")));var d=[];$tpls.forEach(function(t,e,o){t.type==r.type&&"396"!==t.id&&"421"!==t.id&&(d[d.length]=t)});var e=tp__record__getFlag_keepcontentifchangerecordtpl(),n="",a=0;"undefined"!=typeof $uplan&&0<$uplan&&(a=$uplan),"undefined"!=typeof $oplan&&0<$oplan&&(a=$oplan);var c="";c+='<div class="tp-record-edit-icons-left__dropdown-menu-flag '+("y"==e?"tp-record-edit-icons-left__dropdown-menu-flag_checked":"")+'" onclick="tp__record__toggleFlag_keepcontentifchangerecordtpl();"><img src="/tpl/img/t-icon-switcher-off.png" class="tp-record-edit-icons-left__switcher-off" width=\'40px\' height=\'25px\'><img src="/tpl/img/t-icon-switcher-on.png" class="tp-record-edit-icons-left__switcher-on" width=\'40px\' height=\'25px\'>&nbsp;'+("RU"==lang?"Сохранять контент при переключении":"Keep content on switch")+"<div class='tp-record-edit-icons-left__switcher-on-hint' style=\""+("y"!=e?"display:none;":"")+'">'+("RU"==lang?"Возможно, блок будет выглядеть не гармонично из-за разной структуры <br>блоков, и потребуется поменять настройки или доработать контент.":"The chosen block may look unbalanced due to the different structure,<br> and you may need to adjust the settings or modify the content.")+"</div></div>",c+='<ul class="tp-record-edit-icons-left__dropdown-menu-ul">';for(var s=0,l=0;l<d.length;l++)void 0!==d[l].disableforplan0&&"y"==d[l].disableforplan0&&"0"==a||void 0!==d[l].disableforplan1&&"y"==d[l].disableforplan1&&"1"==a||(n="",void 0!==d[l].icon&&""!==d[l].icon&&(n=0===d[l].icon.indexOf("https://static.")?d[l].icon:"https://assets.tildacdn.com/files/tplicons/tpl_"+d[l].id+".png"),c+="<li><a href=\"javascript:tp__changeRecordTpl('"+t+"','"+d[l].id+'\');" class="tp-tplswitch-item" data-tplinfo-icon="'+n+'"><span '+(i==d[l].id?'style="opacity:0.3;"':"")+">"+d[l].cod+":</span> "+("RU"==lang&&void 0!==d[l].title_ru&&""!==d[l].title_ru?d[l].title_ru:d[l].title)+"</a></li>",s++);c+="</ul>",0<s&&o.html(c),o.find(".tp-tplswitch-item").hover(function(){var t=$(this).attr("data-tplinfo-icon");0===$(".tp-tplswitch-item__icon").length?($("body").append($('<div class="tp-tplswitch-item__icon"><img src="'+t+'"></div>')),tp__record__stick_div_to_mouse(".tp-tplswitch-item__icon")):$(".tp-tplswitch-item__icon").find("img").attr("src",t),window.clearInterval(window.stickloopclose)},function(){window.stickloopclose=setTimeout(function(){window.clearInterval(window.stickloop),$(".tp-tplswitch-item__icon").remove()},30)})}o.toggleClass("tp-record-edit-icons-left__dropdown-menu_opened"),o.mouseleave(function(){o.removeClass("tp-record-edit-icons-left__dropdown-menu_opened"),$(".tp-tplswitch-item__icon").remove(),void 0!==window.stickloop&&window.clearInterval(window.stickloop)}),o.find("a").click(function(){o.removeClass("tp-record-edit-icons-left__dropdown-menu_opened"),$(".tp-tplswitch-item__icon").remove(),void 0!==window.stickloop&&window.clearInterval(window.stickloop)})}function tp__record__toggleFlag_keepcontentifchangerecordtpl(){var t=tp__record__getFlag_keepcontentifchangerecordtpl();tp__record__setFlag_keepcontentifchangerecordtpl(t="y"==t?($(".tp-record-edit-icons-left__dropdown-menu-flag").removeClass("tp-record-edit-icons-left__dropdown-menu-flag_checked"),$(".tp-record-edit-icons-left__switcher-on-hint").css("display","none"),""):($(".tp-record-edit-icons-left__dropdown-menu-flag").addClass("tp-record-edit-icons-left__dropdown-menu-flag_checked"),$(".tp-record-edit-icons-left__switcher-on-hint").css("display","block"),"y"))}function tp__record__getFlag_keepcontentifchangerecordtpl(){var t="";return void 0===window.tp_flag_keepcontentifchagerecordtpl?(t="y"==(t=localStorage.getItem("tp-flag-keepcontentifchagerecordtpl"))?"y":"",window.tp_flag_keepcontentifchagerecordtpl=t):t=window.tp_flag_keepcontentifchagerecordtpl,t}function tp__record__setFlag_keepcontentifchangerecordtpl(t){localStorage.setItem("tp-flag-keepcontentifchagerecordtpl",t),window.tp_flag_keepcontentifchagerecordtpl=t}function tp__record__showMapCritycalText(t,e){var o=$("#record"+t+'[off="n"]');0!=o.length&&(t='Error! Provider "'+e+'" is not found.',"google"===e?t="RU"===window.lang?'<b>Внимание:</b> Google Maps API key не указан. Без него карта может не работать. <a href="https://developers.google.com/maps/documentation/javascript/get-api-key?hl=ru" target="_blank">Получить ключ для Google Maps</a><br>Прочитать подробную инструкцию в нашем <a href="http://help-ru.tilda.ws/google-maps" style="color:#fa8669 !important;" target="_blank">справочном центре</a>':'<b>Attention:</b> Google Maps API key not found. Please, input key in [Content] tab. <a href="https://developers.google.com/maps/documentation/javascript/get-api-key?hl=ru" target="_blank">Get Google Maps API key</a><br>Read the instruction in our <a href="http://help.tilda.ws/google-maps" style="color:#fa8669 !important;" target="_blank">Help Center</a>':"yandex"===e&&(t="RU"===window.lang?'<b>Внимание:</b> Yandex Maps API key не указан. Без него карта может не работать. <a href="http://help-ru.tilda.ws/yandex-maps" target="_blank">Получить ключ для Yandex Maps</a>':"<b>Attention:</b> Yandex Maps API key not found. Please, set key in [Content] tab."),o.find(".r").after('<div style="margin: 0px;text-align: left; font-family: tfutura,Arial; position: relative; max-width: 100%;"><div style=" background: yellow; padding: 40px 40px;"><div style="width: 40px; height: 40px; float: left; display: inline-block;margin-left: 80px;margin-top: -80px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><path fill="#ff0" d="M0 40l40-20v20H0z"/></svg></div>'+t+"<br></div></div>"))}function tp__record__showFormCritycalText(t,e,o,i,r,d){var n="",a=$("#record"+t);return 0!=a.length&&(0!=a.find(".js-errorbox-all").length&&("NO"==e&&(n+='<span style="font-weight: 300">'+("RU"==d?"Форма подключена успешно. Текущие настройки:<br>Домены, с которых будут приниматься данные: ":"Form has been assigned. Current settings:<br>Data will be received from domains: ")+'</span> <span style="font-weight: 500">'+o+'</span><br><span style="font-weight: 300">'+("RU"==d?"Данные отправляются на:":"Data will be sent to:")+'</span> <span style="font-weight: 500">'+(i=$("<textarea>").html(i).text())+"</span>"),"NEED_INPUT_SCRIPT"==e&&(i=o="",0<$("#allrecords").data("tilda-project-id")&&(o="<a href='/projects/settings/?projectid="+$("#allrecords").data("tilda-project-id")+"#tab=ss_menu_forms'>",i="</a>"),n+="RU"==d?"<b>Внимание:</b> Настройка формы не завершена. У вас выбран вариант «принимать данные на свой скрипт», но адрес скрипта не указали. Пожалуйста, укажите адрес, на который будут приходить данные из формы. Либо, чтобы использовать наш сервис приема данных, подключите приемщик данных в "+o+"настройках сайта"+i+".":"<b>Attention:</b> form assigning is not completed. You’ve set “Own script for receive data ”, but you didn’t put down a script address. Please put down a script address to which data from the form has been sent. Or, to use our service of data capture, assign Data Receiver in the Site Settings."),"NEED_CONNECT_RECEIVER"==e&&(n+="RU"==d?"<b>Внимание:</b> Настройка формы не завершена. Пожалуйста, нажмите кнопку «Контент» этого блока и поставьте галочку напротив приемщика данных.":"<b>Attention:</b> form assigning is not completed. Please press the button “Content” of this block and check the box across the Data Receiver."),"yes"==r&&"NO"==e&&(n+="<br><br><b>"+("RU"==d?"Обязательно опубликуйте страницу, чтобы применить внесенные изменения":"Publish page please")+"</b>"),"NO"==e&&"yes"!=r||$("#record"+t+" .r").after('<div style="margin: 0px;text-align: left; font-family: tfutura,Arial; position: relative;"><div style="max-width: 100%; background: yellow; padding: 40px 40px; box-sizing: border-box;" class="t-container"><div style="width: 40px; height: 40px; float: left; display: inline-block;margin-left: 80px;margin-top: -80px;"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" height = "40px"  width = "40px"><polygon fill="yellow" stroke="yellow" stroke-width="0" points="0,40  40,20 40,40 0,40" /></svg></div>'+n+"<br></div></div>"),!0))}function tp__record__showCritycalText(t,e){var o="";return 0!=$("#record"+t).length&&("OLDTPL"==e?o="RU"==lang?"Этот блок устарел и больше не поддерживается. Он может работать некорректно. Пожалуйста, добавьте из библиотеки новую версию блока или подберите аналогичный. Перенесите контент в новый блок и переопубликуйте страницу.":"This block is outdated and is not supported anymore. It may work incorrectly. Please add the new version of the block from the library or match the analogic one. Move the content to the new block and re-publish a page.":"string"==typeof e&&""!==e&&(o=e),""!=o&&$("#record"+t+" .r").after('<div style="margin: 0px;text-align: left; font-family: tfutura,Arial; position: relative;"><div style="max-width: 100%; background: yellow; padding: 40px 40px; box-sizing: border-box;" class="t-container"><div style="width: 40px; height: 40px; float: left; display: inline-block;margin-left: 80px;margin-top: -80px;"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" height = "40px"  width = "40px"><polygon fill="yellow" stroke="yellow" stroke-width="0" points="0,40  40,20 40,40 0,40" /></svg></div>'+o+"<br></div></div>"),!0)}function tp__record__editField(){var t;"q"===window.ver_redactor?(t=this,setTimeout(function(){tp__record__editField_quill($(t))})):tp__record__editField_v2($(this))}function tp__record__editField_quill(d){var n,a,t,e,o,i,r,c;function s(t){var e=d.find(".ql-editor"),o=$("#for_redactor_toolbar"),i=$(".quill-modal"),r=$(t.target).closest(".quill-tooltip");$(t.target).closest(e).length||$(t.target).closest(o).length||0!==i.length||!d.find(".ql-editor").length||r.length||(r=Quill.getFormatContent(d.find(".ql-editor")[0]),d[0].innerHTML=r,d.bind("click",tp__record__editField),$(document).off("click",s),$("#for_redactor_toolbar").finish(),$("#mainmenu").finish(),$("#for_redactor_toolbar").animate({opacity:"0",top:"-60px"},400,"easeInCirc",function(){$("#for_redactor_toolbar").html(""),$("#mainmenu").animate({opacity:"1",top:"0px"},300,"easeOutCirc")}),window.waschanged&&tp__record__saveEditedField(a,n),d.data("noclickatthistime","yes"))}"yes"!=d.data("noclickatthistime")?($(".editinplacefield").each(function(){tp__record__saveEditedField(tp__getRecordid(d),d.parent().attr("field"))}),d.unbind("click",tp__record__editField),i=d.css(["height","color","background-color","font-size","font-family","line-height","font-weight","text-align","letter-spacing"]),n=d.attr("field"),a=tp__getRecordid(d),r=Quill.fixCustomStyle(d.html()),t=Quill.getCursorPosition(d[0]),(e=[])[n]=r.html,tempdatafields[a]=e,e="",e+='<div id="editrecord'+a+"field"+n+'" class="editinplacefield">',e+=""+r.html,e+="</div>",d.html(e),$("#textarearecord"+a+"field"+n).css(i),d.find("#cnsleditrec").click(function(){var t=$("#record"+a+" [field='"+n+"']");t.html(tempdatafields[a][n]),t.data("noclickatthistime","yes"),t.click(tp__record__editField)}),d.find("#sveditrec").click(function(){tp__record__saveEditedField(a,n)}),$("#for_redactor_toolbar").stop(),$("#mainmenu").stop(),$("#for_redactor_toolbar").css("opacity","0"),"object"==typeof(d=d)&&"no"==d.attr("data-redactor-toolbar")||$("#mainmenu").animate({opacity:"0",top:"-60px"},400,"easeInCirc",function(){$("#for_redactor_toolbar").animate({opacity:"1",top:"0px"},300,"easeOutCirc")}),window.country||(window.country=$("body").data("country")),window.waschanged="",e=r.styles,o=$("#for_redactor_toolbar"),i={toolbar_content:{selector:"#for_redactor_toolbar",hint:!0,callback:function(t){var e=$(t.root).parent().parent().parent().attr("data-elem-id");void 0!==e&&!1!==e&&(o.find(".ql-color_custom").css("display","none"),o.find(".ql-weight_custom").css("display","none"),o.find(".ql-font_custom").css("display","none"),o.find(".ql-size_custom").css("display","none"),o.find(".ql-lineheight_custom").css("display","none"),o.find(".ql-align_custom").css("display","none")),o.find(".ql-list").css("display","none");t=$(t.root).parent().parent().attr("data-redactor-notoolbar");void 0!==t&&!1!==t&&o.find("button").css("display","none"),"y"==window.$is_email&&(o.find(".ql-weight_custom").css("display","none"),o.find(".ql-font_custom").css("display","none"),o.find(".ql-size_custom").css("display","none"),o.find(".ql-lineheight_custom").css("display","none"),o.find(".ql-align_custom").css("display","none"))}},popup:!0,tooltip:!0,dropdown:!0,textcolor:".ql-color_custom",weightDropdown:".ql-weight_custom",fontDropdown:".ql-font_custom",sizeDropdown:".ql-size_custom",lineheightDropdown:".ql-lineheight_custom",alignDropdown:".ql-align_custom",typograph:".ql-typograph_custom",cleanstyle:".ql-clean_custom",tilda_hotkeys:!0,toolbar:{container:"#for_redactor_toolbar",toolbarOptions:["bold","italic","underline",{list:"ordered"},{list:"bullet"},"link"]}},void 0===(r=$("#editrecord"+a+"field"+n).parent().attr("data-redactor-nohref"))&&(i.tilda_link=".ql-link_custom"),c=new Quill("#editrecord"+a+"field"+n,{formats:["bold","color","font","italic","link","size","strike","underline","list","align","weight","lineheight","align"],debug:!1,modules:i}),Quill.setCustomStyles(c.root,e),tp__record__showTextStyle(c),c.on("editor-change",function(){window.waschanged="yes",tp__record__showTextStyle(c)}),void 0!==r&&!1!==r&&o.find(".ql-link_custom").css("display","none"),$("#editrecord"+a+"field"+n+" .ql-editor")[0].focus({preventScroll:!0}),t.start?c.setSelection(t.start,t.offset):c.focus(),$(document).off("mousedown",s),$(document).on("mousedown",s)):d.data("noclickatthistime","")}function tp__record__editField_v2(t){var e,o,i,r;"yes"!=t.data("noclickatthistime")?($(".editinplacefield").each(function(){tp__record__saveEditedField(tp__getRecordid(t),t.parent().attr("field"))}),t.unbind("click",tp__record__editField),e=t.css(["height","color","background-color","font-size","font-family","line-height","font-weight","text-align","letter-spacing"]),o=t.attr("field"),i=tp__getRecordid(t),(r=[])[o]=t.html(),tempdatafields[i]=r,r="",r+='<div id="editrecord'+i+"field"+o+'" class="editinplacefield">',r+='<textarea name="'+o+'" class="edittextarearecordfield" id="textarearecord'+i+"field"+o+"\" style='width:100%; border:0; margin:0; padding:0;'>",r+=""+tp__htmlEncode(t.html()),r+="</textarea>",r+="</div>",t.html(r),$("#textarearecord"+i+"field"+o).css(e),t.find("#cnsleditrec").click(function(){var t=$("#record"+i+" [field='"+o+"']");t.html(tempdatafields[i][o]),t.data("noclickatthistime","yes"),t.click(tp__record__editField)}),t.find("#sveditrec").click(function(){tp__record__saveEditedField(i,o)}),$("#for_redactor_toolbar").stop(),$("#mainmenu").stop(),$("#for_redactor_toolbar").html(""),$("#for_redactor_toolbar").css("opacity","0"),$("#mainmenu").animate({opacity:"0",top:"-60px"},400,"easeInCirc",function(){"object"==typeof t&&"no"==t.attr("data-redactor-toolbar")||$("#for_redactor_toolbar").animate({opacity:"1",top:"0px"},300,"easeOutCirc")}),window.country||(window.country=$("body").data("country")),window.waschanged="",$("#textarearecord"+i+"field"+o).redactor({lang:"RU"==lang?"ru":"en",buttons:["bold","italic","deleted","link",""],focus:!0,linebreaks:!0,allowedTags:["p","a","i","b","br","div","del","u","ul","ol","li","sup","sub","em","table","tr","td","th","tbody","thead","strike","span","inline","strong"],replaceDivs:!1,cleanOnPaste:!0,toolbarExternal:"#for_redactor_toolbar",plugins:"RU"==window.country||"BY"==window.country||"UA"==window.country?["underline","fontcolorex","fontweight","setfontfamily","setfontsize","setlineheight","setalign","typograf","clearstyle"]:["underline","fontcolorex","fontweight","setfontfamily","setfontsize","setlineheight","setalign","clearstyle"],dragUpload:!1,initCallback:function(t){1==this.$editor.has("div").is("div")&&(void 0!==(e=getAttrStrintoArr(this.$editor.find("div").attr("style")))["font-size"]&&""!=e["font-size"]&&this.setfontsize.enter(e["font-size"]),void 0!==e["line-height"]&&""!=e["line-height"]&&this.setlineheight.enter(e["line-height"]),void 0!==e["text-align"]&&""!=e["text-align"]&&this.setalign.enter(e["text-align"]),void 0!==e["font-family"]&&""!=e["font-family"]&&this.setfontfamily.enter(e["font-family"]),void 0!==e.color&&""!=e.color&&this.fontcolorex.enter(e.color),this.$editor.find("div").contents().unwrap()),redactor_showTextSyle(this);var e=this.$editor.parent().parent().parent().parent().attr("data-elem-id");void 0!==e&&!1!==e&&((o=$("#for_redactor_toolbar")).find(".re-fontcolor").css("display","none"),o.find(".re-fontweight").css("display","none"),o.find(".re-setfontfamily").css("display","none"),o.find(".re-setfontsize").css("display","none"),o.find(".re-setlineheight").css("display","none"),o.find(".re-setalign").css("display","none"),o.find(".re-clearstyle").css("display","none"));e=this.$editor.parent().parent().parent().attr("data-redactor-nohref");void 0!==e&&!1!==e&&(o=$("#for_redactor_toolbar")).find(".re-link").css("display","none");var o,e=this.$editor.parent().parent().parent().attr("data-redactor-notoolbar");void 0!==e&&!1!==e&&(o=$("#for_redactor_toolbar")).find(".redactor-toolbar").css("display","none"),"undefined"!=typeof $is_email&&"y"==$is_email&&((o=$("#for_redactor_toolbar")).find(".re-fontweight").css("display","none"),o.find(".re-setfontfamily").css("display","none"),o.find(".re-setfontsize").css("display","none"),o.find(".re-setlineheight").css("display","none"),o.find(".re-setalign").css("display","none"))},changeCallback:function(t){window.waschanged="yes"},dropdownShownCallback:function(t,e,o){redactor_showTextSyle(this)},blurCallback:function(t){var e;$("#for_redactor_toolbar").finish(),$("#mainmenu").finish(),$("#for_redactor_toolbar").animate({opacity:"0",top:"-60px"},400,"easeInCirc",function(){$("#for_redactor_toolbar").html(""),$("#mainmenu").animate({opacity:"1",top:"0px"},300,"easeOutCirc")}),window.waschanged?tp__record__saveEditedField(i,o):((e=$("#record"+i+" [field='"+o+"']")).html(tempdatafields[i][o]),e.data("noclickatthistime","yes"),e.click(tp__record__editField))},pasteBeforeCallback:function(t){return void 0===t?t:t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=$.htmlClean(t,{format:!0,allowedTags:["div","span","p","h1","h2","h3","a","i","b","br","del","u","ul","ol","li","sup","sub","em","strike","strong"],allowedClasses:[""],allowedAttributes:[["href"],["style"],["rel"],["data-verified"],["data-redactor-tag"],["data-redactor-style"]]})).replace(/<h1\s(.*?)>/gi,"<h1>")).replace(/<h1><br\s?\/?><\/h1>/gi,"<br /><br />")).replace(/<h1>([\w\W]*?)<\/h1>/gi,"$1<br /><br />")).replace(/<h2\s(.*?)>/gi,"<h2>")).replace(/<h2><br\s?\/?><\/h2>/gi,"<br /><br />")).replace(/<h2>([\w\W]*?)<\/h2>/gi,"$1<br /><br />")).replace(/<h3\s(.*?)>/gi,"<h3>")).replace(/<h3><br\s?\/?><\/h3>/gi,"<br /><br />")).replace(/<h3>([\w\W]*?)<\/h3>/gi,"$1<br /><br />")).replace(/<div\s(.*?)>/gi,"<div>")).replace(/<div><br\s?\/?><\/div>/gi,"<br />")).replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br />")}})):t.data("noclickatthistime","")}function tp__record__saveEditedField(t,e,o){var i,r,d,n;void 0!==(o="q"===window.ver_redactor?$("#rec"+t+" [field="+e+"]").html():$("#textarearecord"+t+"field"+e).val())&&(o=o.replace(/&nbsp;/g," "),r="",null!=(i=$("#editrecord"+t+"field"+e)).attr("data-redactor-font-size")&&(r=r+"font-size:"+i.attr("data-redactor-font-size")+";"),null!=i.attr("data-redactor-line-height")&&(r=r+"line-height:"+i.attr("data-redactor-line-height")+";"),null!=i.attr("data-redactor-text-align")&&(r=r+"text-align:"+i.attr("data-redactor-text-align")+";"),null!=i.attr("data-redactor-font-family")&&(r=r+"font-family:"+i.attr("data-redactor-font-family")+";"),null!=i.attr("data-redactor-color")&&(r=r+"color:"+i.attr("data-redactor-color")+";"),""!=r&&(o='<div style="'+r+'" data-customstyle="yes">'+o+"</div>"),r=o.length,"li_"==e.substr(0,3)&&3e3<r&&td__showBubbleNotice("RU"==window.lang?"Предупреждение: в поле слишком много текста. Мы рекомендуем его сократить.":"Note: Too much data in this input field. We strongly recommend reducing the amount of information."),65e3<r&&"code"!=e?td__showBubbleNotice("RU"==window.lang?"Ошибка: слишком много текста. Изменения не будут сохранены. Пожалуйста, удалите часть информации.":"Error: Too much data. Changes will not be saved. Please delete some of the information."):(showLoadIcon(),d=Date.now(),(n={comm:"saverecord"}).pageid=window.pageid,n.recordid=t,n[e]=o,n.onlythisfield=e,$.ajax({type:"POST",url:"/page/submit/",data:n,dataType:"text",success:function(t){check_logout(t),""!=t&&("too much data"==t&&(t="RU"==window.lang?"Ошибка: слишком много текста. Изменения не будут сохранены. Пожалуйста, удалите часть информации.":"Error: Too much data. Changes will not be saved. Please delete some of the information."),td__showBubbleNotice(t)),tp__showUndoButton()},error:function(t){var e=Date.now()-d;if(0==t.status&&e<300)alert("Request error (saving text). Please check your Internet connection and try again.");else{try{errorLog({e:"saverecord",data:n,xhr:t.status,ts:e})}catch(t){}alert("Request timeout (saving text)")}},complete:function(t){hideLoadIcon()},timeout:6e4}),(e=$("#record"+t+" [field='"+e+"']")).html(o),""==o&&e.remove(),e.data("noclickatthistime","yes"),e.click(tp__record__editField)))}function tp__getRecordid(t){for(var e=0;!o&&e<16;){var o=t.attr("recordid");t=t.parent(),e++}return o||console.log("Error. Recordid not found"),o}function tp__htmlEncode(t){return $("<div/>").text(t).html()}function addRedactor_to_textarea(t){("q"===window.ver_redactor?tp__addRedactor_to_textarea_quill:tp__addRedactor_to_textarea_v2)(t)}function tp__addRedactor_to_textarea_quill(t){var e=t.val(),o=t.attr("placeholder"),i=t.parent(),r=t.parents(".pe-form-group")[0],d=t.attr("name"),n=$(r).attr("data-lid");t.css("display","none");r=Quill.fixCustomStyle(e),e=r.styles;t.after('<div class="pe-redactor__wrapper" quill-name="'+d+'" quill-lid="'+n+'">'+r.html+"</div>"),"undefined"==typeof lang&&(lang="en");n={toolbar_content:{hint:!0,toolbarClass:"pe-redactor__toolbar",editorWrapper:i,showByClick:!0,callback:function(t){var e;"undefined"!=typeof $is_email&&"y"==$is_email&&((e=$(".pe-redactor__toolbar")).find(".ql-color_custom").css("display","none"),e.find(".ql-weight_custom").css("display","none"),e.find(".ql-font_custom").css("display","none"),e.find(".ql-size_custom").css("display","none"),e.find(".ql-lineheight_custom").css("display","none"),e.find(".ql-align_custom").css("display","none"),e.find(".ql-clean_custom").css("display","none"))}},popup:!0,tooltip:!0,clipboard:!0,dropdown:!0,textcolor:".ql-color_custom",weightDropdown:".ql-weight_custom",fontDropdown:".ql-font_custom",sizeDropdown:".ql-size_custom",lineheightDropdown:".ql-lineheight_custom",alignDropdown:".ql-align_custom",typograph:".ql-typograph_custom",cleanstyle:".ql-clean_custom",tilda_hotkeys:!0,toolbar:{container:'[quill-name="'+d+'"][quill-lid="'+n+'"] + .pe-redactor__toolbar',toolbarOptions:["bold","italic","underline",{list:"ordered"},{list:"bullet"},"link"]}};""!==window.lireplaces&&void 0!==window.lireplaces[d]&&null!=window.lireplaces[d].redactor_nohref||(n.tilda_link=".ql-link_custom");var a=new Quill(i.find(".pe-redactor__wrapper")[0],{placeholder:o||"",formats:["bold","color","font","italic","link","size","strike","underline","list","align","weight","lineheight","align"],debug:!1,modules:n});Quill.setCustomStyles(a.root,e),a.on("editor-change",function(){window.waschanged="yes",t.val(Quill.getFormatContent(a.root))}),"object"==typeof window.lireplaces[d]&&"yes"==window.lireplaces[d].redactor_nohref&&i.find(".pe-redactor__toolbar").find(".ql-link_custom").css("display","none")}function tp__addRedactor_to_textarea_v2(t){"undefined"==typeof lang&&(lang="en"),t.redactor({lang:"RU"==lang?"ru":"en",linebreaks:!0,boldTag:"b",italicTag:"i",replaceDivs:!1,allowedTags:["p","a","i","b","br","div","del","u","ul","ol","li","hr","sup","sub","em","table","tr","td","th","tbody","thead","strike","span","inline","strong","h1","h2","h3","h4","h5","h6"],buttons:["bold","italic","deleted","link","unorderedlist","orderedlist",""],dragUpload:!1,plugins:"RU"==window.country||"BY"==window.country||"UA"==window.country?["underline","fontcolorex","fontweight","setfontfamily","setfontsize","setlineheight","setalign","typograf","clearstyle"]:["underline","fontcolorex","fontweight","setfontfamily","setfontsize","setlineheight","setalign","clearstyle"],initCallback:function(){this.$toolbar.css("display","none")},changeCallback:function(t){window.waschanged="yes"},focusCallback:function(t){var e;this.$toolbar.css("display","block"),1==this.$editor.has("div").is("div")&&(void 0!==(e=getAttrStrintoArr(this.$editor.find("div").attr("style")))["font-size"]&&""!=e["font-size"]&&this.setfontsize.enter(e["font-size"]),void 0!==e["line-height"]&&""!=e["line-height"]&&this.setlineheight.enter(e["line-height"]),void 0!==e["text-align"]&&""!=e["text-align"]&&this.setalign.enter(e["text-align"]),void 0!==e["font-family"]&&""!=e["font-family"]&&this.setfontfamily.enter(e["font-family"]),void 0!==e.color&&""!=e.color&&this.fontcolorex.enter(e.color),this.$editor.find("div").contents().unwrap())},blurCallback:function(t){var e,o,i;this.$toolbar.css("display","none"),window.waschanged&&(e=(e=this.$editor.html()).replace(/&nbsp;/g," "),o="",null!=(i=this.$box.parent()).attr("data-redactor-font-size")&&(o=o+"font-size:"+i.attr("data-redactor-font-size")+";"),null!=i.attr("data-redactor-line-height")&&(o=o+"line-height:"+i.attr("data-redactor-line-height")+";"),null!=i.attr("data-redactor-text-align")&&(o=o+"text-align:"+i.attr("data-redactor-text-align")+";"),null!=i.attr("data-redactor-font-family")&&(o=o+"font-family:"+i.attr("data-redactor-font-family")+";"),null!=i.attr("data-redactor-color")&&(o=o+"color:"+i.attr("data-redactor-color")+";"),""!=o&&(e='<div style="'+o+'" data-customstyle="yes">'+e+"</div>",this.$editor.html(e),this.code.sync()),setTimeout(function(){i.find("textarea").trigger("change")},100))},pasteBeforeCallback:function(t){return void 0===t?t:t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=$.htmlClean(t,{format:!0,allowedTags:["div","span","p","h1","h2","h3","a","i","b","br","del","u","ul","ol","li","sup","sub","em","strike","strong"],allowedClasses:[""],allowedAttributes:[["href"],["style"],["rel"],["data-verified"],["data-redactor-tag"],["data-redactor-style"]]})).replace(/<h1\s(.*?)>/gi,"<h1>")).replace(/<h1><br\s?\/?><\/h1>/gi,"<br /><br />")).replace(/<h1>([\w\W]*?)<\/h1>/gi,"$1<br /><br />")).replace(/<h2\s(.*?)>/gi,"<h2>")).replace(/<h2><br\s?\/?><\/h2>/gi,"<br /><br />")).replace(/<h2>([\w\W]*?)<\/h2>/gi,"$1<br /><br />")).replace(/<h3\s(.*?)>/gi,"<h3>")).replace(/<h3><br\s?\/?><\/h3>/gi,"<br /><br />")).replace(/<h3>([\w\W]*?)<\/h3>/gi,"$1<br /><br />")).replace(/<div\s(.*?)>/gi,"<div>")).replace(/<div><br\s?\/?><\/div>/gi,"<br />")).replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br />")}})}function tp__record__showTextStyle(t){var e=$(t.root);var o=parseInt(e.css("font-size")),i=e.css("font-family").replace(", serif","").replace(", sans-serif","").replace("'","").replace("'",""),r=[],d=[],e=!1,t=function(t){for(var e,o=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)o.push(e);return o}(t.root);$.each(t,function(t,e){e=e.parentNode;r.push("font-family"===e.style[0]?$(e).css("font-family"):i),d.push("font-size"===e.style[0]?parseInt($(e).css("font-size").split("px")[0]):o)}),e=r.length===t.length,$.unique(r),$.unique(d),1===r.length&&e&&(i=r[0]),1<r.length&&(i="Mixed"),1===d.length&&(o=d[0]);t=o+"px, "+i,e=$("#for_redactor_toolbar");$("#rightfontinfo").remove(),$(".rightfontinfo-instruction").remove(),"RU"===window.lang?(e.append('<div id="rightfontinfo" style="position:absolute; z-index:2060;top:0px;right:82px; height:60px; line-height:60px; font-size:11px; opacity:0.7;">'+t+"</div>"),e.append('<a class="rightfontinfo-instruction" style="position: absolute; right: 49px; top: 19px;" target="_blank" href="http://help-ru.tilda.ws/text-editor"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.5"><circle cx="10" cy="10" r="9.5" transform="rotate(180 10 10)" stroke="black"/></g><path d="M10.2223 14.444C9.05556 13.932 12.1665 9.95545 10.8797 8.66169C10.0001 7.77733 8.88886 8.33317 8.33347 8.6621C8.29532 8.68469 8.40693 8.77548 8.38047 8.79872C8.57492 8.69375 9.69626 8.67496 9.58198 9.81569C9.48938 10.74 7.73007 13.3521 8.65601 14.7747C9.34153 15.828 11.0701 15.6635 12.1127 14.4336L12.0279 14.3396C11.1868 14.5943 10.7316 14.6676 10.2223 14.444Z" fill="#727272"/><circle cx="10.7776" cy="5.55545" r="1.11111" fill="#727272"/></svg></a>'),e.append('<a class="rightfontinfo-instruction" style="position: absolute; right: 14px; top: 15px;" target="_blank" href="https://youtu.be/8uiOpkY0vcQ"><svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.5"><circle cx="18.9356" cy="5.75084" r="4.60191" stroke="black"/><path d="M18.9341 8.81248L18.9341 4.73096" stroke="black"/><path d="M18.9341 3.71081L18.9341 2.69043" stroke="black"/><path d="M9.38974 16.0077V12.6164L11.7542 14.312L9.38974 16.0077Z" fill="black" stroke="black"/><path d="M11.7917 4.84569C11.3165 4.77113 10.8295 4.73242 10.3334 4.73242C5.17869 4.73242 1 8.91111 1 14.0658C1 19.2205 5.17869 23.3992 10.3334 23.3992C15.4881 23.3992 19.6667 19.2205 19.6667 14.0658C19.6667 13.6707 19.6422 13.2813 19.5945 12.8991" stroke="black"/></g></svg></a>')):(e.append('<div id="rightfontinfo" style="position:absolute; z-index:2060;top:0px;right:49px; height:60px; line-height:60px; font-size:11px; opacity:0.7;">'+t+"</div>"),e.append('<a class="rightfontinfo-instruction" style="position: absolute; right: 14px; top: 19px;" target="_blank" href="https://help.tilda.cc/text-editor"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.5"><circle cx="10" cy="10" r="9.5" transform="rotate(180 10 10)" stroke="black"/></g><path d="M10.2223 14.444C9.05556 13.932 12.1665 9.95545 10.8797 8.66169C10.0001 7.77733 8.88886 8.33317 8.33347 8.6621C8.29532 8.68469 8.40693 8.77548 8.38047 8.79872C8.57492 8.69375 9.69626 8.67496 9.58198 9.81569C9.48938 10.74 7.73007 13.3521 8.65601 14.7747C9.34153 15.828 11.0701 15.6635 12.1127 14.4336L12.0279 14.3396C11.1868 14.5943 10.7316 14.6676 10.2223 14.444Z" fill="#727272"/><circle cx="10.7776" cy="5.55545" r="1.11111" fill="#727272"/></svg></a>'))}function redactor_showTextSyle(t){var e=t.$editor;1==$(e).has("div").is("div")&&(e=e.children());var o=parseInt(e.css("font-size")),i=parseInt(e.css("line-height")),r=e.css("font-family").replace(", serif","").replace(", sans-serif","").replace("'","").replace("'",""),t=o+"px, "+r,e=$("#for_redactor_toolbar").find(".redactor-toolbar");$("#rightfontinfo").remove(),e.after('<div id="rightfontinfo" style="position:absolute; z-index:2060;top:0px;right:20px; height:50px; line-height:50px; font-size:11px; opacity:0.7;">'+t+"</div>"),$(".redactor-dropdown-box-setfontsize").children().each(function(t){$(this).text()==o+"px"?($(this).css("background-color","#eeeeee"),$(this).parent().animate({scrollTop:$(this).position().top-85},400)):$(this).css("background-color","")}),$(".redactor-dropdown-box-setfontfamily").children().each(function(t){$(this).text()==r?$(this).css("background-color","#eeeeee"):$(this).css("background-color","")}),$(".redactor-dropdown-box-setlineheight").children().each(function(t){$(this).text().replace("px","")<=i&&$(this).next().text().replace("px","")>i?($(this).css("background-color","#eeeeee"),$(this).parent().animate({scrollTop:$(this).position().top-85},400)):$(this).css("background-color","")})}function getAttrStrintoArr(t){if(""==t||null==t||0==t)return"";for(var e,o=t.split(";"),i={},r=0,d=o.length;r<d;r++)e=o[r].split(":"),i[$.trim(e[0])]=$.trim(e[1]);return i}function tp__record__bufCut(e){0<e&&(showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"cutrecord_tobuf",pageid:window.pageid,recordid:e},dataType:"text",success:function(t){hideLoadIcon(),check_logout(t),$(".record[data-cuted=yes]").css("opacity",""),$(".record").removeAttr("data-cuted"),$("#record"+e).css("opacity","0.5"),$("#record"+e).attr("data-cuted","yes"),showCornerNotice("RU"==lang?"Блок скопирован в буфер":"The block are copied to the clipboard",3e3)},error:function(){hideLoadIcon(),alert("Request timeout (block cutting to buffer)")},timeout:3e4}))}function tp__record__bufCopy(t){0<t&&(showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"copyrecord_tobuf",pageid:window.pageid,recordid:t},dataType:"text",success:function(t){hideLoadIcon(),check_logout(t),$(".record[data-cuted=yes]").css("opacity",""),$(".record").removeAttr("data-cuted"),""!==t&&console.log(t)},error:function(){hideLoadIcon(),alert("Request timeout (block coping to buffer)")},timeout:3e4}))}function tp__selectedrecords__bufCopy(){var t=Array();$(".record_selected","#allrecords").each(function(){t.push($(this).attr("id").replace("record",""))}),0<t.length&&(showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"copyselectedrecords_tobuf",pageid:window.pageid,selects:t},dataType:"text",success:function(t){hideLoadIcon(),check_logout(t),showCornerNotice("RU"==lang?"Блоки скопированы в буфер. <b>Используйте кнопку вставить</b>":"Blocks copied to the clipboard",4e3),window.somerecordsinbuffer="yes",tp__updateSelectModeButtons()},error:function(){hideLoadIcon(),alert("Request timeout (coping blocks to buffer)")},timeout:3e4}))}function tp__record__bufPaste(e){showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"pasterecord_frombuf",pageid:window.pageid,recordid:e},dataType:"text",success:function(t){var o;hideLoadIcon(),check_logout(t),""!==t&&("no data in buffer"==t?alert("RU"==lang?"В буфере пусто":"Nothing to paste"):($("#record"+e).after(t),0<(o=$(t).attr("id"))&&($("#"+o).css("opacity","0"),$("#"+o).animate({opacity:"1"},700,"easeInCirc"),$("html, body").animate({scrollTop:$("#"+o).offset().top-100},700)),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList(),showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"delrecord_incutbuf",pageid:window.pageid},dataType:"text",success:function(t){var e;hideLoadIcon(),check_logout(t),$("html, body").animate({scrollTop:$("#"+o).offset().top-100},700),0<t&&(e=$("#record"+t),(t=document.body.querySelector("#record"+t+" video"))&&window.videoLoadProcessor.unergisterVideo(t),e.remove(),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList(),$("html, body").stop(),$("html, body").animate({scrollTop:$("#"+o).offset().top-100},700))}})))}})}function tp__selectModeOn(t){tp__hideSortButtons(),tp__showSelectButtons(),tp__updateSelectModeButtons(),tp__hideEditRecordsButtons(),$("[field]").off(),$("[imgfield]").off(),$(".record").click(function(){$(this).toggleClass("record_selected"),$(this).toggleClass("active"),tp__updateSelectModeButtons()}),void 0!==t&&($("#record"+t).toggleClass("record_selected"),$("#record"+t).toggleClass("active"),tp__updateSelectModeButtons()),showCornerNotice("RU"==lang?"Режим работы с группой блоков: <b>кликните на блок, чтобы его выделить.</b>":"Block operation mode: <b>click on the block to select.</b>",5e3)}function tp__deleteRecordsSelected(){var r=Array();$(".record_selected","#allrecords").each(function(){r.push($(this).attr("id").replace("record",""))}),showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"deleterecordsselected",pageid:window.pageid,selects:r},dataType:"text",success:function(t){check_logout(t),hideLoadIcon();for(var e=0;e<r.length;e++){var o=r[e],i=$("#record"+o);(o=document.body.querySelector("#record"+o+" video"))&&window.videoLoadProcessor.unergisterVideo(o),i.slideUp("fast",function(){i.remove()})}$(".record").removeClass("record_selected"),tp__updateSelectModeButtons(),tp__updateUndoButton(),void 0!==window.blockList&&window.blockList.rebuildList(),""!=t&&console.log(t)}})}function tp__cancelSelect(){tp__hideSelectButtons(),location.reload()}function tp__showSelectButtons(){$("#saveselectbuttons").css("display","block"),$(".record").css("cursor","pointer"),$("body").append("<div id='select_records_toolbar'><div class='select_records_toolbar__left'>"+("RU"==window.lang?"Режим работы с группой блоков: <b>кликните на блок, чтобы его выделить.</b>":"Block selection mode: <b>click block to select.</b>")+"</div><div class='select_records_toolbar__right'><a href='javascript:cancelSelect();'>"+("RU"==window.lang?"Вернуться к редактированию":"Back to editing</a>")+"</a></div></div>"),$("#mainmenu").animate({opacity:"0",top:"-50px"},400,"easeInCirc",function(){$("#select_records_toolbar").animate({opacity:"1",top:"0px"},300,"easeOutCirc")})}function tp__hideSelectButtons(){$(".record").css("cursor","auto"),$("#saveselectbuttons").css("display","none")}function tp__hideEditRecordsButtons(){$(".record").off("hover"),$(".recordediticons").css("display","none"),$(".recordediticons").css("display","none"),$(".recordbordertop").css("display","none"),$(".recordborderbottom").css("display","none"),$(".insertafterrecorbutton").css("display","none"),$("#shortcuttooldiv").css("display","none"),$("#dragsingleimagescont").css("display","none")}function tp__updateSelectModeButtons(){var t=Array();$(".record_selected","#allrecords").each(function(){t.push($(this).attr("id").replace("record",""))}),0<t.length?($("#selectmodebtn-move").css("display","inline-block"),$("#selectmodebtn-del").css("display","inline-block"),$("#selectmodebtn-copy").css("display","inline-block")):($("#selectmodebtn-move").css("display","none"),$("#selectmodebtn-del").css("display","none"),$("#selectmodebtn-copy").css("display","none")),void 0!==window.somerecordsinbuffer?$("#selectmodebtn-paste").css("display","inline-block"):$("#selectmodebtn-paste").css("display","none")}function tp__selectedrecords__movemodeon(){window.selectsarr=Array(),$(".record_selected","#allrecords").each(function(){window.selectsarr.push($(this).attr("id").replace("record",""))});for(var t=0;t<selectsarr.length;t++){var e=selectsarr[t];$("#record"+e).css("opacity","0.15")}$(".record").removeClass("record_selected"),$(".record").off("click"),tp__updateSelectModeButtons(),$(".record","#allrecords").each(function(){var t='<div class="recordborderbottom"></div>';t+='<div class="insertafterrecorbutton"><center><a href="javascript:tp__moveSelectedRecords(\''+$(this).attr("id").replace("record","")+'\');"><span class="glyphicon glyphicon-plus-sign" style="color:#000; width:20px; height:20px;"></span></a></center></div>',$(this).append("<div class='moveplacer'>"+t+"</div>")}),$(".record").mouseover(function(){$(".moveplacer").css("display","none"),$(this).find(".moveplacer").css("display","block")}),$(".record").click(function(){tp__moveSelectedRecords($(this).attr("id").replace("record",""))}),showCornerNotice("RU"==lang?"Кликните в тот блок, после которого вы хотите поставить выбранные блоки.":"Click the block after which you want to put the selected blocks.",8e3)}function tp__moveSelectedRecords(t){0<window.selectsarr.length&&(showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"moveselectedrecords",pageid:window.pageid,recordid:t,selects:window.selectsarr},dataType:"text",success:function(t){check_logout(t),hideLoadIcon(),window.location.href="https://tilda.cc/page/?pageid="+window.pageid+"#scrolltorecord="+window.selectsarr[0],window.location.reload(!0)}}))}function tp__selectedrecords__pastemodeon(){$(".record").removeClass("record_selected"),$(".record").removeClass("active"),$(".record").off("click"),delete window.somerecordsinbuffer,tp__updateSelectModeButtons(),$(".record","#allrecords").each(function(){var t='<div class="recordborderbottom"></div>';t+='<div class="insertafterrecorbutton"><center><a href="javascript:tp__pasteSelectedRecords(\''+$(this).attr("id").replace("record","")+'\');"><span class="glyphicon glyphicon-plus-sign" style="color:#000; width:20px; height:20px;"></span></a></center></div>',$(this).append("<div class='moveplacer'>"+t+"</div>")}),$(".record").mouseover(function(){$(".moveplacer").css("display","none"),$(this).find(".moveplacer").css("display","block")}),$(".record").click(function(){tp__pasteSelectedRecords($(this).attr("id").replace("record",""))}),showCornerNotice("RU"==lang?"Кликните в тот блок, после которого вы хотите вставить блоки из буфера.":"Click the block after which you want to insert blocks from the clipboard.",8e3)}function tp__pasteSelectedRecords(e){showLoadIcon(),"y"!=window.prevent_dubble_PasteCall&&(window.prevent_dubble_PasteCall="y",$.ajax({type:"POST",url:"/page/submit/",data:{comm:"pasterecord_frombuf",pageid:window.pageid,recordid:e},dataType:"text",success:function(t){hideLoadIcon(),""!==t&&(check_logout(t),"no data in buffer"==t?alert("Nothing to Paste"):($("#record"+e).after(t),t=$(t).attr("id").replace("record",""),$("html, body").animate({scrollTop:$("#record"+t).offset().top-100},700),window.location.href="https://tilda.cc/page/?pageid="+window.pageid+"#scrolltorecord="+t,window.location.reload(!0))),window.location.reload(!0)}}))}function tp__savesortmodeifactive(){("block"==$("#savesortbuttons").css("display")||0<autosavesort_timer)&&tp__saveRecordsSort()}var autosavesort_timer;function tp__sortModeOn(){tp__hideSelectButtons(),$("#allrecords").sortable({helper:"clone",opacity:.8,revert:!0,tolerance:"pointer",handle:"#sorthandle",axis:"y",start:function(t,e){clearTimeout(autosavesort_timer)},change:function(t,e){clearTimeout(autosavesort_timer)},update:function(t,e){tp__showSortButtons(),void 0!==window.blockList&&window.blockList.rebuildList(),autosavesort_timer=setTimeout(function(){tp__saveRecordsSort()},7e3)}})}function tp__cancelSort(){tp__hideSortButtons(),location.reload()}function tp__saveRecordsSort(){clearTimeout(autosavesort_timer),0<autosavesort_timer&&(autosavesort_timer=void 0);var t=Array();$("#allrecords .record").each(function(){t.push($(this).attr("id").replace("record",""))}),tp__ajax("/page/submit/",{comm:"saverecordssort",pageid:window.pageid,sorts:t},{ctext:"save blocks order"},function(t){hideLoadIcon(),check_logout(t),tp__hideSortButtons(),tp__updateUndoButton()},function(){setTimeout(function(){location.reload()},3e3)})}function tp__showSortButtons(){$("#savesortbuttons").css({display:"block"}),$(".sortupicon").css({display:"block"}),$(".sortdownicon").css({display:"block"}),$(".sortonicon").css({display:"none"})}function tp__hideSortButtons(){$("#savesortbuttons").css({display:"none"}),$(".sortupicon").css({display:"none"}),$(".sortdownicon").css({display:"none"}),$(".sortonicon").css({display:"block"})}function tp__convertRecordtoZero(t){$(".pe-zero-convert-btn").css("display","none"),$(".pe-zero-convert-notice").css("display","block");var e="";e+='<div style="font-size:14px; color:#777; padding-top:25px;">',"RU"==lang?e+="При конвертации блок вернется к начальному состоянию — с текстом и фото по умолчанию.":e+="As a result of converting to Zero Block, the block will return to its starting appearance — with default text and photos. If you change text and photos to your own ones they will not be saved.",e+='<a href="javascript:tp__convertRecordtoZero_do('+t+');" style="margin-top:10px; display:block; height:50px; width:200px; line-height:50px; padding:0 20px; background-color:#000; color:#fff;cursor: pointer;">'+("RU"==lang?"Конвертировать":"Convert without saving content")+"</a>",e+='<a href="javascript:tp__convertRecordtoZero_cancel();" style="margin-top:5px; display:block; height:50px; width:200px; line-height:50px; padding:0 20px; border:1px solid rgba(0,0,0,0.1);cursor: pointer;">'+("RU"==lang?"Отмена":"Cancel")+"</a>",e+="</div>",$(".pe-zero-convert-notice").html(e)}function tp__convertRecordtoZero_cancel(){$(".pe-zero-convert-btn").css("display","block"),$(".pe-zero-convert-notice").css("display","none")}function tp__convertRecordtoZero_do(e){showLoadIcon(),$.ajax({type:"POST",url:"/page/submit/",data:{comm:"converttozero",pageid:window.pageid,recordid:e},dataType:"text",success:function(t){hideLoadIcon(),""!=t?(check_logout(t),alert(t)):(edrec__closeEditForm(),$("html, body").animate({scrollTop:$("#record"+e).offset().top-100},700),tp__updateRecord(e)),tp__updateUndoButton()},error:function(){alert("Request timeout (changing block template)"),hideLoadIcon(),location.reload()},timeout:9e4})}function tp__openZero(t,e){var o=window.pageid;console.log("func: tn_openeditor");var i=$("body");i.addClass("t396__body_overflow_hidden"),i.attr("data-zero-opened-recordid",t),$("#intercom-container").addClass("t396__display_none");var r=Math.random().toString(36).substring(7);i.append("<iframe class='t396__iframe' src=\"/zero/?recordid="+t+"&pageid="+o+"&iframe=y&nocash="+r+'" width="100vw" height="100vh"></iframe>'),$(".t396__iframe").focus(),window.history.replaceState&&("replacestate"==e?window.history.replaceState({module:"zero",recordid:t},"","/zero/?recordid="+t+"&pageid="+o):window.history.pushState({module:"zero",recordid:t},"","/zero/?recordid="+t+"&pageid="+o))}function tn_close(t,e){tp__closeZero(t,e)}function tp__closeZero(t,e){void 0===t&&void 0!==(t=$("body").attr("data-zero-opened-recordid"))&&""!=t&&(t=+t),console.log("func: tn_close. rec:"+t),$(".t396__iframe").remove();var o=$("body");o.removeClass("t396__body_overflow_hidden"),o.removeAttr("data-zero-opened-recordid"),$("#intercom-container").removeClass("t396__display_none"),0<t&&(tp__updateRecord(t),(t=$("#record"+t).offset())&&$("html, body").animate({scrollTop:t.top-100},700)),window.history.replaceState&&0<e&&window.history.pushState(null,"","/page/?pageid="+e)}function tui_editimage(t,r,d){var e=document.querySelector('img[id="'+r+'"]').getAttribute("src");window.upload_saveAs=function(t,e){"function"!=typeof showLoadIcon&&($("body").append('<div id="loadicon" style="display: none; position: fixed; z-index: 1200; padding: 0; left: 10px; top: 60px;"><img src="/tpl/img/ajax-loader.gif"></div>'),window.showLoadIcon=function(){$("#loadicon").css({display:"block"})}),showLoadIcon(),tu=TUWidget.init($(".tui-image-editor-canvas-container").eq(0)),tu.done(function(t){var e,o,i;t.tuInfo&&t.tuInfo.cdnUrl&&(e=t.tuInfo.cdnUrl,null!=(i=document.getElementById(r))&&(i.src=e),"function"==typeof d?d(r,t.tuInfo):0<(o=$("#"+r).closest(".js-image-box")).length?(o.find(".js-img-cdnurl").val(e),o.find(".js-img-uuid").val(""),o.find(".js-img-name").val(""),o.find(".js-img-size").val(""),o.find(".js-img-width").val(""),o.find(".js-img-height").val(""),i=e.substring(e.length-30),o.find(".js-img-title").attr("href",e).html("..."+i),0<t.tuInfo.width&&o.find("js-img-width").val(t.tuInfo.width)):console.log(e),"function"==typeof window.tuiEditor.destroy&&window.tuiEditor.destroy(),$("#tuiEditorTildaWidget").remove(),window.tuiEditor=!1,"function"!=typeof hideLoadIcon&&(window.hideLoadIcon=function(){$("#loadicon").css({display:"none"})}),hideLoadIcon())}),tu.uploadFileFromURL(t)},window.tuiEditor&&(document.querySelector(".tui__editor-container").style.display="block"),tui_onReady(e)}function tui_initImageEditor(t){var e;0<t.indexOf("ucarecdn")||0<t.indexOf("tildacdn.info")?(e=t.lastIndexOf("/"))!=t.length-1&&(t=t.substring(0,e+1)):"/"==t.substring(0,1)&&(t="https://tilda.cc"+t);t={includeUI:{menu:["newSize","crop","flip","rotate","text","draw","filter"],loadImage:{path:t,name:"SampleImage"},menuBarPosition:"top",usageStatistics:!1},cssMaxWidth:800,cssMaxHeight:600,usageStatistics:!1};"RU"===window.lang&&(t.includeUI.locale={Undo:"Назад",Redo:"Вперёд",Reset:"Сбросить",Delete:"Удалить","Delete-all":"Удалить всё",Rotate:"Повернуть",Save:"Сохранить",Width:"Ширина",Height:"Высота","Lock proportion":"Сохранить пропорции",Custom:"Произвольный",Crop:"Обрезать",Apply:"Применить",Cancel:"Отменить",Flip:"Развернуть","Flip X":"По горизонтали","Flip Y":"По вертикали",Angle:"Угол",Text:"Добавить текст",Bold:"Жирный",Italic:"Курсив",Underline:"Подчеркнуть",Left:"Влево",Center:"По центру",Right:"Вправо",Color:"Цвет","Text size":"Размер",Draw:"Нарисовать линию",Free:"Свободная",Straight:"Прямая",Size:"Размер",Filter:"Добавить фильтр",Grayscale:"Градации серого",Sepia:"Сепия",Blur:"Размытие",Emboss:"Тиснение",Invert:"Инверсия",Sepia2:"Сепия 2",Sharpen:"Резкость","Remove White":"Удалить белый цвет",Distance:"Расстояние",Value:"Значение",Brightness:"Яркость",Noise:"Шум",Pixelate:"Пикселизация","Color Filter":"Фильтр цвета",Threshold:"Порог"}),window.tuiEditor=new tui.ImageEditor("#tui-image-editor-container",t),window.onresize=function(){window.tuiEditor?window.tuiEditor.ui.resizeEditor():setTimeout(function(){window.onresize()},300)}}function tui_onReady(t){var e,o;window.tuiEditor?(e=t.split("/"),window.tuiEditor.loadImageFromURL(t,e?e[e.length-1]:"photo")):window.tuiEditorLoad?(tui_addTuiContainer(),tui_initImageEditor(t)):0==$("#tuiEditorTildaScriptVersion").length&&((e=document.createElement("link")).rel="stylesheet",e.id="tuiEditorStyle",e.href="/front/css/tui.min.css",document.documentElement.appendChild(e),"RU"===window.lang&&((o=document.createElement("style")).id="tuiEditorStyleRussian",o.textContent=".tui-image-editor-container .color-picker-control .tui-image-editor-range {width: 75px;}.tui-image-editor-container .tui-image-editor-submenu-align:first-child label {width: 95px;}.tui-image-editor-container .tui-image-editor-submenu-align label {width: 75px;}.tui-image-editor-container .tui-image-editor-checkbox-wrap.fixed-width {width: 230px;}",document.documentElement.appendChild(o)),(o=document.createElement("script")).src="/front/js/tui-im-edit.min.js",o.id="tuiEditorTildaScriptVersion",document.documentElement.appendChild(o),o.onload=o.onerror=function(){window.tuiEditorLoad=!0,this.executed||(this.executed=!0,tui_onReady(t))},o.onreadystatechange=function(){var t=this;"complete"!=this.readyState&&"loaded"!=this.readyState||setTimeout(function(){t.onload()},0)})}function tui_addTuiContainer(){0<$("#tuiEditorTildaWidget").length&&($("#tuiEditorTildaWidget").remove(),window.tuiEditor=!1);var t=document.createElement("div");t.id="tuiEditorTildaWidget",t.className="tui__editor-container",t.innerHTML='<div class="tui__editor-fullscreen_bg"></div><div class="tui__editor-wrap"><div class="tui__editor-header"><span>Photo Editor</span><span class="tui__editor-header-close"></span></div><div id="tui-image-editor-container"></div></div>',document.documentElement.appendChild(t),document.querySelector(".tui__editor-header-close").onclick=function(){t.style.display="none",window.tuiEditor=!1,$("#tuiEditorTildaWidget").remove()}}function openImageSearchPopup(e,t,o){o=o||"",showLoadIcon(),$.cachedScript("https://front.tildacdn.com/ccimagesearch/js/t__imagesearch.min.js").done(function(){0==$("#css-tis-imagesearch").length&&$("body").append('<link id="css-tis-imagesearch" rel="stylesheet" href="https://front.tildacdn.com/ccimagesearch/css/t_imagesearch.min.css">'),window.tis__imgid&&window.tis__userid&&window.tis__userhash?(hideLoadIcon(),tis__showImageSearch(e,window.tis__userid,window.tis__userhash)):$.ajax({type:"POST",url:"/projects/get/getimagesearch/",data:{imgid:t,recid:o,v:2},dataType:"text",success:function(t){check_logout(t),(t=$.parseJSON(t)).userid?(hideLoadIcon(),window.tis__userid=t.userid,window.tis__userhash=t.userhash,tis__showImageSearch(e,t.userid,t.userhash)):alert("Not found user")},error:function(){alert("Request Timeout"),location.reload()},timeout:3e4})})}window.onpopstate=function(t){void 0===t.state||null===t.state?$("body").hasClass("t396__body_overflow_hidden")&&tp__closeZero():void 0!==t.state.module&&"zero"==t.state.module&&tp__openZero(t.state.recordid,"replacestate")};
